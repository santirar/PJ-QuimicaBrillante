/*! For license information please see 3316-05a4a5f6a5636118c73b.js.LICENSE.txt */
"use strict";(self.webpackChunkcircle=self.webpackChunkcircle||[]).push([[3316],{33315:(e,t,s)=>{s.d(t,{Z:()=>ut});var i={};s.r(i),s.d(i,{getItem:()=>E,removeItem:()=>k,setItem:()=>U});var r=s(28596);class o extends Error{constructor(e,t){void 0===t&&(t=null),super("This looks like a network error, the endpoint might be blocked by an internet provider or a firewall."),this.cause=e,this.isNetworkError=!0,this.request=t}}const n=o;function a(){return fetch(...arguments).catch((e=>{throw"AbortError"===e.name?e:new n(e)}))}class l extends Error{constructor(e,t){var s,i;void 0===t&&(t={}),super(e),this.cause=t.cause,this.cause&&(s=this.cause,i="isNetworkError",Object.prototype.hasOwnProperty.call(s,i))&&(this.isNetworkError=this.cause.isNetworkError)}}const p=l;class u extends Error{constructor(){super("Authorization required"),this.name="AuthError",this.isAuthError=!0}}const h=u;let d;function c(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var m=0;function f(e){return"__private_"+m+++"_"+e}async function g(e){if(401===e.status)throw new h;const t=e.json();if(e.status<200||e.status>300){let s=`Failed request with status: ${e.status}. ${e.statusText}`;try{const e=await t;s=e.message?`${s} message: ${e.message}`:s,s=e.requestId?`${s} request-Id: ${e.requestId}`:s}finally{throw new Error(s)}}return t}var y=f("companionHeaders"),v=f("getPostResponseFunc"),b=f("getUrl"),w=f("errorHandler");d=Symbol.for("uppy test: getCompanionHeaders");class P{constructor(e,t){Object.defineProperty(this,w,{value:O}),Object.defineProperty(this,b,{value:S}),Object.defineProperty(this,y,{writable:!0,value:void 0}),Object.defineProperty(this,v,{writable:!0,value:e=>t=>e?t:this.onReceiveResponse(t)}),this.uppy=e,this.opts=t,this.onReceiveResponse=this.onReceiveResponse.bind(this),this.allowedHeaders=["accept","content-type","uppy-auth-token"],this.preflightDone=!1,c(this,y)[y]=null==t?void 0:t.companionHeaders}setCompanionHeaders(e){c(this,y)[y]=e}[d](){return c(this,y)[y]}get hostname(){const{companion:e}=this.uppy.getState(),t=this.opts.companionUrl;return(e&&e[t]?e[t]:t).replace(/\/$/,"")}headers(){return Promise.resolve({...P.defaultHeaders,...c(this,y)[y]})}onReceiveResponse(e){const t=this.uppy.getState().companion||{},s=this.opts.companionUrl,{headers:i}=e;return i.has("i-am")&&i.get("i-am")!==t[s]&&this.uppy.setState({companion:{...t,[s]:i.get("i-am")}}),e}preflight(e){return this.preflightDone?Promise.resolve(this.allowedHeaders.slice()):fetch(c(this,b)[b](e),{method:"OPTIONS"}).then((e=>(e.headers.has("access-control-allow-headers")&&(this.allowedHeaders=e.headers.get("access-control-allow-headers").split(",").map((e=>e.trim().toLowerCase()))),this.preflightDone=!0,this.allowedHeaders.slice()))).catch((e=>(this.uppy.log(`[CompanionClient] unable to make preflight request ${e}`,"warning"),this.preflightDone=!0,this.allowedHeaders.slice())))}preflightAndHeaders(e){return Promise.all([this.preflight(e),this.headers()]).then((e=>{let[t,s]=e;return Object.keys(s).forEach((e=>{t.includes(e.toLowerCase())||(this.uppy.log(`[CompanionClient] excluding disallowed header ${e}`),delete s[e])})),s}))}get(e,t){return this.preflightAndHeaders(e).then((t=>a(c(this,b)[b](e),{method:"get",headers:t,credentials:this.opts.companionCookiesRule||"same-origin"}))).then(c(this,v)[v](t)).then(g).catch(c(this,w)[w]("get",e))}post(e,t,s){const i="post";return this.preflightAndHeaders(e).then((s=>a(c(this,b)[b](e),{method:i,headers:s,credentials:this.opts.companionCookiesRule||"same-origin",body:JSON.stringify(t)}))).then(c(this,v)[v](s)).then(g).catch(c(this,w)[w](i,e))}delete(e,t,s){const i="delete";return this.preflightAndHeaders(e).then((s=>a(`${this.hostname}/${e}`,{method:i,headers:s,credentials:this.opts.companionCookiesRule||"same-origin",body:t?JSON.stringify(t):null}))).then(c(this,v)[v](s)).then(g).catch(c(this,w)[w](i,e))}}function S(e){return/^(https?:|)\/\//.test(e)?e:`${this.hostname}/${e}`}function O(e,t){return s=>{var i;return null!=(i=s)&&i.isAuthError||(s=new p(`Could not ${e} ${c(this,b)[b](t)}`,{cause:s})),Promise.reject(s)}}function U(e,t){return new Promise((s=>{localStorage.setItem(e,t),s()}))}function E(e){return Promise.resolve(localStorage.getItem(e))}function k(e){return new Promise((t=>{localStorage.removeItem(e),t()}))}P.VERSION="3.0.2",P.defaultHeaders={Accept:"application/json","Content-Type":"application/json","Uppy-Versions":`@uppy/companion-client=${P.VERSION}`};class j extends P{constructor(e,t){super(e,t),this.provider=t.provider,this.id=this.provider,this.name=this.opts.name||(e=>e.split("-").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" "))(this.id),this.pluginId=this.opts.pluginId,this.tokenKey=`companion-${this.pluginId}-auth-token`,this.companionKeysParams=this.opts.companionKeysParams,this.preAuthToken=null}headers(){return Promise.all([super.headers(),this.getAuthToken()]).then((e=>{let[t,s]=e;const i={};return s&&(i["uppy-auth-token"]=s),this.companionKeysParams&&(i["uppy-credentials-params"]=btoa(JSON.stringify({params:this.companionKeysParams}))),{...t,...i}}))}onReceiveResponse(e){e=super.onReceiveResponse(e);const t=this.uppy.getPlugin(this.pluginId),s=t.getPluginState().authenticated?401!==e.status:e.status<400;return t.setPluginState({authenticated:s}),e}setAuthToken(e){return this.uppy.getPlugin(this.pluginId).storage.setItem(this.tokenKey,e)}getAuthToken(){return this.uppy.getPlugin(this.pluginId).storage.getItem(this.tokenKey)}async ensurePreAuth(){if(this.companionKeysParams&&!this.preAuthToken&&(await this.fetchPreAuthToken(),!this.preAuthToken))throw new Error("Could not load authentication data required for third-party login. Please try again later.")}authUrl(e){void 0===e&&(e={});const t=new URLSearchParams(e);return this.preAuthToken&&t.set("uppyPreAuthToken",this.preAuthToken),`${this.hostname}/${this.id}/connect?${t}`}fileUrl(e){return`${this.hostname}/${this.id}/get/${e}`}async fetchPreAuthToken(){if(this.companionKeysParams)try{const e=await this.post(`${this.id}/preauth/`,{params:this.companionKeysParams});this.preAuthToken=e.token}catch(e){this.uppy.log(`[CompanionClient] unable to fetch preAuthToken ${e}`,"warning")}}list(e){return this.get(`${this.id}/list/${e||""}`)}logout(){return this.get(`${this.id}/logout`).then((e=>Promise.all([e,this.uppy.getPlugin(this.pluginId).storage.removeItem(this.tokenKey)]))).then((e=>{let[t]=e;return t}))}static initPlugin(e,t,s){if(e.type="acquirer",e.files=[],s&&(e.opts={...s,...t}),t.serverUrl||t.serverPattern)throw new Error("`serverUrl` and `serverPattern` have been renamed to `companionUrl` and `companionAllowedHosts` respectively in the 0.30.5 release. Please consult the docs (for example, https://uppy.io/docs/instagram/ for the Instagram plugin) and use the updated options.`");if(t.companionAllowedHosts){const s=t.companionAllowedHosts;if("string"!==typeof s&&!Array.isArray(s)&&!(s instanceof RegExp))throw new TypeError(`${e.id}: the option "companionAllowedHosts" must be one of string, Array, RegExp`);e.opts.companionAllowedHosts=s}else/^(?!https?:\/\/).*$/i.test(t.companionUrl)?e.opts.companionAllowedHosts=`https://${t.companionUrl.replace(/^\/\//,"")}`:e.opts.companionAllowedHosts=new URL(t.companionUrl).origin;e.storage=e.opts.storage||i}}var F=s(44800);let T,R;function A(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var $=0;function C(e){return"__private_"+$+++"_"+e}var x=C("queued"),I=C("emitter"),M=C("isOpen"),N=C("socket"),q=C("handleMessage");T=Symbol.for("uppy test: getSocket"),R=Symbol.for("uppy test: getQueued");class _{constructor(e){Object.defineProperty(this,x,{writable:!0,value:[]}),Object.defineProperty(this,I,{writable:!0,value:F()}),Object.defineProperty(this,M,{writable:!0,value:!1}),Object.defineProperty(this,N,{writable:!0,value:void 0}),Object.defineProperty(this,q,{writable:!0,value:e=>{try{const t=JSON.parse(e.data);this.emit(t.action,t.payload)}catch(t){console.log(t)}}}),this.opts=e,e&&!1===e.autoOpen||this.open()}get isOpen(){return A(this,M)[M]}[T](){return A(this,N)[N]}[R](){return A(this,x)[x]}open(){A(this,N)[N]=new WebSocket(this.opts.target),A(this,N)[N].onopen=()=>{for(A(this,M)[M]=!0;A(this,x)[x].length>0&&A(this,M)[M];){const e=A(this,x)[x].shift();this.send(e.action,e.payload)}},A(this,N)[N].onclose=()=>{A(this,M)[M]=!1},A(this,N)[N].onmessage=A(this,q)[q]}close(){var e;null==(e=A(this,N)[N])||e.close()}send(e,t){A(this,M)[M]?A(this,N)[N].send(JSON.stringify({action:e,payload:t})):A(this,x)[x].push({action:e,payload:t})}on(e,t){A(this,I)[I].on(e,t)}emit(e,t){A(this,I)[I].emit(e,t)}once(e,t){A(this,I)[I].once(e,t)}}function z(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var L=0;function H(e){return"__private_"+L+++"_"+e}var D=H("emitter"),B=H("events");class K{constructor(e){Object.defineProperty(this,D,{writable:!0,value:void 0}),Object.defineProperty(this,B,{writable:!0,value:[]}),z(this,D)[D]=e}on(e,t){return z(this,B)[B].push([e,t]),z(this,D)[D].on(e,t)}remove(){for(const[e,t]of z(this,B)[B].splice(0))z(this,D)[D].off(e,t)}}const V=s(93096)((function(e,t,s){const{progress:i,bytesUploaded:r,bytesTotal:o}=t;i&&(e.uppy.log(`Upload progress: ${i}`),e.uppy.emit("upload-progress",s,{uploader:e,bytesUploaded:r,bytesTotal:o}))}),300,{leading:!0,trailing:!0});function W(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var G=0;function X(e){return"__private_"+G+++"_"+e}var Z=X("activeRequests"),J=X("queuedHandlers"),Y=X("paused"),Q=X("pauseTimer"),ee=X("downLimit"),te=X("upperLimit"),se=X("rateLimitingTimer"),ie=X("call"),re=X("queueNext"),oe=X("next"),ne=X("queue"),ae=X("dequeue"),le=X("resume"),pe=X("increaseLimit");class ue{constructor(e){Object.defineProperty(this,ae,{value:fe}),Object.defineProperty(this,ne,{value:me}),Object.defineProperty(this,oe,{value:ce}),Object.defineProperty(this,re,{value:de}),Object.defineProperty(this,ie,{value:he}),Object.defineProperty(this,Z,{writable:!0,value:0}),Object.defineProperty(this,J,{writable:!0,value:[]}),Object.defineProperty(this,Y,{writable:!0,value:!1}),Object.defineProperty(this,Q,{writable:!0,value:void 0}),Object.defineProperty(this,ee,{writable:!0,value:1}),Object.defineProperty(this,te,{writable:!0,value:void 0}),Object.defineProperty(this,se,{writable:!0,value:void 0}),Object.defineProperty(this,le,{writable:!0,value:()=>this.resume()}),Object.defineProperty(this,pe,{writable:!0,value:()=>{if(W(this,Y)[Y])W(this,se)[se]=setTimeout(W(this,pe)[pe],0);else{W(this,ee)[ee]=this.limit,this.limit=Math.ceil((W(this,te)[te]+W(this,ee)[ee])/2);for(let e=W(this,ee)[ee];e<=this.limit;e++)W(this,re)[re]();W(this,te)[te]-W(this,ee)[ee]>3?W(this,se)[se]=setTimeout(W(this,pe)[pe],2e3):W(this,ee)[ee]=Math.floor(W(this,ee)[ee]/2)}}}),this.limit="number"!==typeof e||0===e?1/0:e}run(e,t){return!W(this,Y)[Y]&&W(this,Z)[Z]<this.limit?W(this,ie)[ie](e):W(this,ne)[ne](e,t)}wrapPromiseFunction(e,t){var s=this;return function(){for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];let n;const a=new Promise(((i,o)=>{n=s.run((()=>{let t,s;try{s=Promise.resolve(e(...r))}catch(a){s=Promise.reject(a)}return s.then((e=>{t?o(t):(n.done(),i(e))}),(e=>{t?o(t):(n.done(),o(e))})),()=>{t=new Error("Cancelled")}}),t)}));return a.abort=()=>{n.abort()},a}}resume(){W(this,Y)[Y]=!1,clearTimeout(W(this,Q)[Q]);for(let e=0;e<this.limit;e++)W(this,re)[re]()}pause(e){void 0===e&&(e=null),W(this,Y)[Y]=!0,clearTimeout(W(this,Q)[Q]),null!=e&&(W(this,Q)[Q]=setTimeout(W(this,le)[le],e))}rateLimit(e){clearTimeout(W(this,se)[se]),this.pause(e),this.limit>1&&Number.isFinite(this.limit)&&(W(this,te)[te]=this.limit-1,this.limit=W(this,ee)[ee],W(this,se)[se]=setTimeout(W(this,pe)[pe],e))}get isPaused(){return W(this,Y)[Y]}}function he(e){W(this,Z)[Z]+=1;let t,s=!1;try{t=e()}catch(i){throw W(this,Z)[Z]-=1,i}return{abort:()=>{s||(s=!0,W(this,Z)[Z]-=1,t(),W(this,re)[re]())},done:()=>{s||(s=!0,W(this,Z)[Z]-=1,W(this,re)[re]())}}}function de(){queueMicrotask((()=>W(this,oe)[oe]()))}function ce(){if(W(this,Y)[Y]||W(this,Z)[Z]>=this.limit)return;if(0===W(this,J)[J].length)return;const e=W(this,J)[J].shift(),t=W(this,ie)[ie](e.fn);e.abort=t.abort,e.done=t.done}function me(e,t){void 0===t&&(t={});const s={fn:e,priority:t.priority||0,abort:()=>{W(this,ae)[ae](s)},done:()=>{throw new Error("Cannot mark a queued request as done: this indicates a bug")}},i=W(this,J)[J].findIndex((e=>s.priority>e.priority));return-1===i?W(this,J)[J].push(s):W(this,J)[J].splice(i,0,s),s}function fe(e){const t=W(this,J)[J].indexOf(e);-1!==t&&W(this,J)[J].splice(t,1)}Symbol("__queue");const{AbortController:ge}=globalThis,{AbortSignal:ye}=globalThis,ve=function(e){return void 0===e&&(e="Aborted"),new DOMException(e,"AbortError")};function be(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var we=0;function Pe(e){return"__private_"+we+++"_"+e}const Se={limit:1,retryDelays:[0,1e3,3e3,5e3],getChunkSize:e=>Math.ceil(e.size/1e4),onStart(){},onProgress(){},onPartComplete(){},onSuccess(){},onError(e){throw e}};function Oe(e){if("string"===typeof e)return parseInt(e,10);if("number"===typeof e)return e;throw new TypeError("Expected a number")}var Ue=Pe("aborted"),Ee=Pe("initChunks"),ke=Pe("createUpload"),je=Pe("resumeUpload"),Fe=Pe("uploadParts"),Te=Pe("retryable"),Re=Pe("prepareUploadPartsRetryable"),Ae=Pe("uploadPartRetryable"),$e=Pe("uploadPart"),Ce=Pe("onPartProgress"),xe=Pe("onPartComplete"),Ie=Pe("uploadPartBytes"),Me=Pe("completeUpload"),Ne=Pe("abortUpload"),qe=Pe("onError");function _e(){return this.abortController.signal.aborted}function ze(){const e=[],t=this.options.getChunkSize(this.file),s=Math.max(5242880,Math.ceil(this.file.size/1e4)),i=Math.max(t,s);if(0===this.file.size)e.push(this.file);else for(let r=0;r<this.file.size;r+=i){const t=Math.min(this.file.size,r+i);e.push(this.file.slice(r,t))}this.chunks=e,this.chunkState=e.map((()=>({uploaded:0,busy:!1,done:!1})))}function Le(){return this.createdPromise=Promise.resolve().then((()=>this.options.createMultipartUpload())),this.createdPromise.then((e=>{if(be(this,Ue)[Ue]())throw ve();if(!("object"===typeof e&&e&&"string"===typeof e.uploadId&&"string"===typeof e.key))throw new TypeError("AwsS3/Multipart: Got incorrect result from `createMultipartUpload()`, expected an object `{ uploadId, key }`.");this.key=e.key,this.uploadId=e.uploadId,this.options.onStart(e),be(this,Fe)[Fe]()})).catch((e=>{be(this,qe)[qe](e)}))}async function He(){try{const e=await this.options.listParts({uploadId:this.uploadId,key:this.key});if(be(this,Ue)[Ue]())throw ve();e.forEach((e=>{const t=e.PartNumber-1;this.chunkState[t]={uploaded:Oe(e.Size),etag:e.ETag,done:!0},this.parts.some((t=>t.PartNumber===e.PartNumber))||this.parts.push({PartNumber:e.PartNumber,ETag:e.ETag})})),be(this,Fe)[Fe]()}catch(e){be(this,qe)[qe](e)}}function De(){if(this.isPaused)return;if(this.chunkState.every((e=>e.done)))return void be(this,Me)[Me]();const e=(()=>{const e=this.options.limit-this.partsInProgress,t=this.chunkState.filter((e=>e.done)).length,s=this.chunks.length-t;let i=Math.ceil(this.options.limit/2);if(i>s&&(i=s),e<i)return[];const r=[];for(let o=0;o<this.chunkState.length;o++){const t=this.chunkState[o];if(!t.done&&!t.busy&&(r.push(o),r.length>=e))break}return r})();0!==e.length&&be(this,Re)[Re](e).then((t=>{let{presignedUrls:s,headers:i}=t;for(const r of e){const e=r+1,t={url:s[e],headers:null==i?void 0:i[e]};be(this,Ae)[Ae](r,t).then((()=>be(this,Fe)[Fe]()),(e=>be(this,qe)[qe](e)))}}),(e=>be(this,qe)[qe](e)))}function Be(e){let{before:t,attempt:s,after:i}=e;const{retryDelays:r}=this.options,{signal:o}=this.abortController;t&&t();const n=e=>s().catch((t=>{if(be(this,Ue)[Ue]())throw ve();if(function(e){if(e.source&&"number"===typeof e.source.status){const{status:t}=e.source;return 0===t||409===t||423===t||t>=500&&t<600}return!1}(t)&&e<r.length)return(s=r[e],i={signal:o},new Promise(((e,t)=>{var r,o;if(null!=i&&null!=(r=i.signal)&&r.aborted)return t(ve());const n=setTimeout((()=>{l(),e()}),s);function a(){clearTimeout(n),l(),t(ve())}function l(){var e;null==i||null==(e=i.signal)||e.removeEventListener("abort",a)}null==i||null==(o=i.signal)||o.addEventListener("abort",a)}))).then((()=>n(e+1)));var s,i;throw t}));return n(0).then((e=>(i&&i(),e)),(e=>{throw i&&i(),e}))}async function Ke(e){e.forEach((e=>{this.chunkState[e].busy=!0}));const t=await be(this,Te)[Te]({attempt:()=>this.options.prepareUploadParts({key:this.key,uploadId:this.uploadId,parts:e.map((e=>({number:e+1,chunk:this.chunks[e]})))})});if("object"!==typeof(null==t?void 0:t.presignedUrls))throw new TypeError("AwsS3/Multipart: Got incorrect result from `prepareUploadParts()`, expected an object `{ presignedUrls }`.");return t}function Ve(e,t){return be(this,Te)[Te]({before:()=>{this.chunkState[e].busy=!0,this.partsInProgress+=1},attempt:()=>be(this,$e)[$e](e,t),after:()=>{this.chunkState[e].busy=!1,this.partsInProgress-=1}})}function We(e,t){if(!("string"===typeof(null==t?void 0:t.url)))throw new TypeError("AwsS3/Multipart: Got incorrect result for `prePreparedPart`, expected an object `{ url }`.");const{url:s,headers:i}=t;if(be(this,Ue)[Ue]())throw ve();return be(this,Ie)[Ie](e,s,i)}function Ge(e,t){this.chunkState[e].uploaded=Oe(t);const s=this.chunkState.reduce(((e,t)=>e+t.uploaded),0);this.options.onProgress(s,this.file.size)}function Xe(e,t){this.chunkState[e].etag=t,this.chunkState[e].done=!0;const s={PartNumber:e+1,ETag:t};this.parts.push(s),this.options.onPartComplete(s)}function Ze(e,t,s){const i=this.chunks[e],{signal:r}=this.abortController;let o;const n=new Promise(((e,t)=>{o={resolve:e,reject:t}})),a=new XMLHttpRequest;function l(){r.removeEventListener("abort",p)}function p(){a.abort()}return a.open("PUT",t,!0),s&&Object.keys(s).forEach((e=>{a.setRequestHeader(e,s[e])})),a.responseType="text",r.addEventListener("abort",p),a.upload.addEventListener("progress",(t=>{t.lengthComputable&&be(this,Ce)[Ce](e,t.loaded,t.total)})),a.addEventListener("abort",(()=>{l(),o.reject(ve())})),a.addEventListener("load",(t=>{if(l(),t.target.status<200||t.target.status>=300){const e=new Error("Non 2xx");return e.source=t.target,void o.reject(e)}this.chunks[e]=null,be(this,Ce)[Ce](e,i.size,i.size);const s=t.target.getResponseHeader("ETag");null!==s?(be(this,xe)[xe](e,s),o.resolve()):o.reject(new Error("AwsS3/Multipart: Could not read the ETag header. This likely means CORS is not configured correctly on the S3 Bucket. See https://uppy.io/docs/aws-s3-multipart#S3-Bucket-Configuration for instructions."))})),a.addEventListener("error",(e=>{l();const t=new Error("Unknown error");t.source=e.target,o.reject(t)})),a.send(i),n}async function Je(){this.parts.sort(((e,t)=>e.PartNumber-t.PartNumber));try{const e=await this.options.completeMultipartUpload({key:this.key,uploadId:this.uploadId,parts:this.parts});this.options.onSuccess(e)}catch(e){be(this,qe)[qe](e)}}function Ye(){this.abortController.abort(),this.createdPromise.then((()=>this.options.abortMultipartUpload({key:this.key,uploadId:this.uploadId}))).catch((()=>{}))}function Qe(e){e&&"AbortError"===e.name||this.options.onError(e)}const et=class{constructor(e,t){Object.defineProperty(this,qe,{value:Qe}),Object.defineProperty(this,Ne,{value:Ye}),Object.defineProperty(this,Me,{value:Je}),Object.defineProperty(this,Ie,{value:Ze}),Object.defineProperty(this,xe,{value:Xe}),Object.defineProperty(this,Ce,{value:Ge}),Object.defineProperty(this,$e,{value:We}),Object.defineProperty(this,Ae,{value:Ve}),Object.defineProperty(this,Re,{value:Ke}),Object.defineProperty(this,Te,{value:Be}),Object.defineProperty(this,Fe,{value:De}),Object.defineProperty(this,je,{value:He}),Object.defineProperty(this,ke,{value:Le}),Object.defineProperty(this,Ee,{value:ze}),Object.defineProperty(this,Ue,{value:_e}),this.options={...Se,...t},this.options.getChunkSize||(this.options.getChunkSize=Se.getChunkSize),this.file=e,this.abortController=new ge,this.key=this.options.key||null,this.uploadId=this.options.uploadId||null,this.parts=[],this.createdPromise=Promise.reject(),this.isPaused=!1,this.partsInProgress=0,this.chunks=null,this.chunkState=null,be(this,Ee)[Ee](),this.createdPromise.catch((()=>{}))}start(){this.isPaused=!1,this.uploadId?be(this,je)[je]():be(this,ke)[ke]()}pause(){this.abortController.abort(),this.abortController=new ge,this.isPaused=!0}abort(e){var t;void 0===e&&(e=void 0),null!=(t=e)&&t.really?be(this,Ne)[Ne]():this.pause()}};let tt;function st(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var it=0;function rt(e){return"__private_"+it+++"_"+e}function ot(e){if(e&&e.error){const t=new Error(e.message);throw Object.assign(t,e.error),t}return e}var nt=rt("queueRequestSocketToken"),at=rt("client"),lt=rt("requestSocketToken"),pt=rt("setCompanionHeaders");tt=Symbol.for("uppy test: getClient");class ut extends r.Z{constructor(e,t){super(e,t),Object.defineProperty(this,nt,{writable:!0,value:void 0}),Object.defineProperty(this,at,{writable:!0,value:void 0}),Object.defineProperty(this,lt,{writable:!0,value:async e=>{const t=new(e.remote.providerOptions.provider?j:P)(this.uppy,e.remote.providerOptions),s={...this.opts};e.tus&&Object.assign(s,e.tus);return(await t.post(e.remote.url,{...e.remote.body,protocol:"s3-multipart",size:e.data.size,metadata:e.meta})).token}}),Object.defineProperty(this,pt,{writable:!0,value:()=>(st(this,at)[at].setCompanionHeaders(this.opts.companionHeaders),Promise.resolve())}),this.type="uploader",this.id=this.opts.id||"AwsS3Multipart",this.title="AWS S3 Multipart",st(this,at)[at]=new P(e,t);const s={timeout:3e4,limit:0,retryDelays:[0,1e3,3e3,5e3],createMultipartUpload:this.createMultipartUpload.bind(this),listParts:this.listParts.bind(this),prepareUploadParts:this.prepareUploadParts.bind(this),abortMultipartUpload:this.abortMultipartUpload.bind(this),completeMultipartUpload:this.completeMultipartUpload.bind(this),companionHeaders:{}};this.opts={...s,...t},this.upload=this.upload.bind(this),this.requests=new ue(this.opts.limit),this.uploaders=Object.create(null),this.uploaderEvents=Object.create(null),this.uploaderSockets=Object.create(null),st(this,nt)[nt]=this.requests.wrapPromiseFunction(st(this,lt)[lt])}[tt](){return st(this,at)[at]}resetUploaderReferences(e,t){void 0===t&&(t={}),this.uploaders[e]&&(this.uploaders[e].abort({really:t.abort||!1}),this.uploaders[e]=null),this.uploaderEvents[e]&&(this.uploaderEvents[e].remove(),this.uploaderEvents[e]=null),this.uploaderSockets[e]&&(this.uploaderSockets[e].close(),this.uploaderSockets[e]=null)}assertHost(e){if(!this.opts.companionUrl)throw new Error(`Expected a \`companionUrl\` option containing a Companion address, or if you are not using Companion, a custom \`${e}\` implementation.`)}createMultipartUpload(e){this.assertHost("createMultipartUpload");const t={};return Object.keys(e.meta).forEach((s=>{null!=e.meta[s]&&(t[s]=e.meta[s].toString())})),st(this,at)[at].post("s3/multipart",{filename:e.name,type:e.type,metadata:t}).then(ot)}listParts(e,t){let{key:s,uploadId:i}=t;this.assertHost("listParts");const r=encodeURIComponent(s);return st(this,at)[at].get(`s3/multipart/${i}?key=${r}`).then(ot)}prepareUploadParts(e,t){let{key:s,uploadId:i,parts:r}=t;this.assertHost("prepareUploadParts");const o=encodeURIComponent(s),n=r.map((e=>e.number)).join(",");return st(this,at)[at].get(`s3/multipart/${i}/batch?key=${o}&partNumbers=${n}`).then(ot)}completeMultipartUpload(e,t){let{key:s,uploadId:i,parts:r}=t;this.assertHost("completeMultipartUpload");const o=encodeURIComponent(s),n=encodeURIComponent(i);return st(this,at)[at].post(`s3/multipart/${n}/complete?key=${o}`,{parts:r}).then(ot)}abortMultipartUpload(e,t){let{key:s,uploadId:i}=t;this.assertHost("abortMultipartUpload");const r=encodeURIComponent(s),o=encodeURIComponent(i);return st(this,at)[at].delete(`s3/multipart/${o}?key=${r}`).then(ot)}uploadFile(e){var t=this;return new Promise(((s,i)=>{let r;const o=new et(e.data,{createMultipartUpload:this.opts.createMultipartUpload.bind(this,e),listParts:this.opts.listParts.bind(this,e),prepareUploadParts:this.opts.prepareUploadParts.bind(this,e),completeMultipartUpload:this.opts.completeMultipartUpload.bind(this,e),abortMultipartUpload:this.opts.abortMultipartUpload.bind(this,e),getChunkSize:this.opts.getChunkSize?this.opts.getChunkSize.bind(this):null,onStart:t=>{const s=this.uppy.getFile(e.id);this.uppy.setFileState(e.id,{s3Multipart:{...s.s3Multipart,key:t.key,uploadId:t.uploadId}})},onProgress:(t,s)=>{this.uppy.emit("upload-progress",e,{uploader:this,bytesUploaded:t,bytesTotal:s})},onError:t=>{this.uppy.log(t),this.uppy.emit("upload-error",e,t),r.done(),this.resetUploaderReferences(e.id),i(t)},onSuccess:t=>{const i=o,n={body:{...t},uploadURL:t.location};r.done(),this.resetUploaderReferences(e.id);const a=this.uppy.getFile(e.id);this.uppy.emit("upload-success",a||e,n),t.location&&this.uppy.log(`Download ${i.file.name} from ${t.location}`),s(i)},onPartComplete:t=>{const s=this.uppy.getFile(e.id);s&&this.uppy.emit("s3-multipart:part-uploaded",s,t)},limit:this.opts.limit||5,retryDelays:this.opts.retryDelays||[],...e.s3Multipart});this.uploaders[e.id]=o,this.uploaderEvents[e.id]=new K(this.uppy),r=this.requests.run((()=>(e.isPaused||o.start(),()=>{}))),this.onFileRemove(e.id,(t=>{r.abort(),this.resetUploaderReferences(e.id,{abort:!0}),s(`upload ${t.id} was removed`)})),this.onCancelAll(e.id,(function(i){let{reason:o}=void 0===i?{}:i;"user"===o&&(r.abort(),t.resetUploaderReferences(e.id,{abort:!0})),s(`upload ${e.id} was canceled`)})),this.onFilePause(e.id,(e=>{e?(r.abort(),o.pause()):(r.abort(),r=this.requests.run((()=>(o.start(),()=>{}))))})),this.onPauseAll(e.id,(()=>{r.abort(),o.pause()})),this.onResumeAll(e.id,(()=>{r.abort(),e.error&&o.abort(),r=this.requests.run((()=>(o.start(),()=>{})))})),e.progress.uploadStarted&&e.isRestored||this.uppy.emit("upload-started",e)}))}async uploadRemote(e){this.resetUploaderReferences(e.id),e.progress.uploadStarted&&e.isRestored||this.uppy.emit("upload-started",e);try{if(e.serverToken)return this.connectToServerSocket(e);const t=await st(this,nt)[nt](e);return this.uppy.setFileState(e.id,{serverToken:t}),this.connectToServerSocket(this.uppy.getFile(e.id))}catch(t){throw this.uppy.emit("upload-error",e,t),t}}connectToServerSocket(e){var t=this;return new Promise(((s,i)=>{let r;const o=e.serverToken,n=function(e){const t=/^(?:https?:\/\/|\/\/)?(?:[^@\n]+@)?(?:www\.)?([^\n]+)/i.exec(e)[1];return`${/^http:\/\//i.test(e)?"ws":"wss"}://${t}`}(e.remote.companionUrl),a=new _({target:`${n}/api/${o}`});this.uploaderSockets[e.id]=a,this.uploaderEvents[e.id]=new K(this.uppy),this.onFileRemove(e.id,(()=>{r.abort(),a.send("cancel",{}),this.resetUploaderReferences(e.id,{abort:!0}),s(`upload ${e.id} was removed`)})),this.onFilePause(e.id,(e=>{e?(r.abort(),a.send("pause",{})):(r.abort(),r=this.requests.run((()=>(a.send("resume",{}),()=>{}))))})),this.onPauseAll(e.id,(()=>{r.abort(),a.send("pause",{})})),this.onCancelAll(e.id,(function(i){let{reason:o}=void 0===i?{}:i;"user"===o&&(r.abort(),a.send("cancel",{}),t.resetUploaderReferences(e.id)),s(`upload ${e.id} was canceled`)})),this.onResumeAll(e.id,(()=>{r.abort(),e.error&&a.send("pause",{}),r=this.requests.run((()=>{a.send("resume",{})}))})),this.onRetry(e.id,(()=>{a.isOpen&&(a.send("pause",{}),a.send("resume",{}))})),this.onRetryAll(e.id,(()=>{a.isOpen&&(a.send("pause",{}),a.send("resume",{}))})),a.on("progress",(t=>V(this,t,e))),a.on("error",(t=>{this.uppy.emit("upload-error",e,new Error(t.error)),this.resetUploaderReferences(e.id),r.done(),i(new Error(t.error))})),a.on("success",(t=>{const i={uploadURL:t.url};this.uppy.emit("upload-success",e,i),this.resetUploaderReferences(e.id),r.done(),s()})),r=this.requests.run((()=>(e.isPaused&&a.send("pause",{}),()=>{})))}))}upload(e){if(0===e.length)return Promise.resolve();const t=e.map((e=>{const t=this.uppy.getFile(e);return t.isRemote?this.uploadRemote(t):this.uploadFile(t)}));return Promise.all(t)}onFileRemove(e,t){this.uploaderEvents[e].on("file-removed",(s=>{e===s.id&&t(s.id)}))}onFilePause(e,t){this.uploaderEvents[e].on("upload-pause",((s,i)=>{e===s&&t(i)}))}onRetry(e,t){this.uploaderEvents[e].on("upload-retry",(s=>{e===s&&t()}))}onRetryAll(e,t){this.uploaderEvents[e].on("retry-all",(()=>{this.uppy.getFile(e)&&t()}))}onPauseAll(e,t){this.uploaderEvents[e].on("pause-all",(()=>{this.uppy.getFile(e)&&t()}))}onCancelAll(e,t){var s=this;this.uploaderEvents[e].on("cancel-all",(function(){s.uppy.getFile(e)&&t(...arguments)}))}onResumeAll(e,t){this.uploaderEvents[e].on("resume-all",(()=>{this.uppy.getFile(e)&&t()}))}install(){const{capabilities:e}=this.uppy.getState();this.uppy.setState({capabilities:{...e,resumableUploads:!0}}),this.uppy.addPreProcessor(st(this,pt)[pt]),this.uppy.addUploader(this.upload)}uninstall(){const{capabilities:e}=this.uppy.getState();this.uppy.setState({capabilities:{...e,resumableUploads:!1}}),this.uppy.removePreProcessor(st(this,pt)[pt]),this.uppy.removeUploader(this.upload)}}ut.VERSION="3.0.2"},58883:(e,t,s)=>{s.d(t,{Z:()=>Es});var i={};s.r(i),s.d(i,{getItem:()=>O,removeItem:()=>U,setItem:()=>S});var r=s(28596);class o extends Error{constructor(e,t){void 0===t&&(t=null),super("This looks like a network error, the endpoint might be blocked by an internet provider or a firewall."),this.cause=e,this.isNetworkError=!0,this.request=t}}const n=o;class a extends Error{constructor(e,t){var s,i;void 0===t&&(t={}),super(e),this.cause=t.cause,this.cause&&(s=this.cause,i="isNetworkError",Object.prototype.hasOwnProperty.call(s,i))&&(this.isNetworkError=this.cause.isNetworkError)}}const l=a;class p extends Error{constructor(){super("Authorization required"),this.name="AuthError",this.isAuthError=!0}}const u=p;let h;function d(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var c=0;function m(e){return"__private_"+c+++"_"+e}const f=new Map;var g=m("companionHeaders"),y=m("getUrl"),v=m("request");h=Symbol.for("uppy test: getCompanionHeaders");class b{constructor(e,t){Object.defineProperty(this,v,{value:P}),Object.defineProperty(this,y,{value:w}),Object.defineProperty(this,g,{writable:!0,value:void 0}),this.uppy=e,this.opts=t,this.onReceiveResponse=this.onReceiveResponse.bind(this),d(this,g)[g]=null==t?void 0:t.companionHeaders}setCompanionHeaders(e){d(this,g)[g]=e}[h](){return d(this,g)[g]}get hostname(){const{companion:e}=this.uppy.getState(),t=this.opts.companionUrl;return(e&&e[t]?e[t]:t).replace(/\/$/,"")}async headers(){return{...{Accept:"application/json","Content-Type":"application/json","Uppy-Versions":`@uppy/companion-client=${b.VERSION}`},...d(this,g)[g]}}onReceiveResponse(e){let{headers:t}=e;const s=this.uppy.getState().companion||{},i=this.opts.companionUrl;t.has("i-am")&&t.get("i-am")!==s[i]&&this.uppy.setState({companion:{...s,[i]:t.get("i-am")}})}async preflight(e){const t=f.get(this.hostname);if(null!=t)return t;const s=["accept","content-type","uppy-auth-token"],i=(async()=>{try{const t=(await fetch(d(this,y)[y](e),{method:"OPTIONS"})).headers.get("access-control-allow-headers");if(null==t||"*"===t)return f.set(this.hostname,s),s;this.uppy.log(`[CompanionClient] adding allowed preflight headers to companion cache: ${this.hostname} ${t}`);const i=t.split(",").map((e=>e.trim().toLowerCase()));return f.set(this.hostname,i),i}catch(t){return this.uppy.log(`[CompanionClient] unable to make preflight request ${t}`,"warning"),f.delete(this.hostname),s}})();return f.set(this.hostname,i),i}async preflightAndHeaders(e){const[t,s]=await Promise.all([this.preflight(e),this.headers()]);return Object.fromEntries(Object.entries(s).filter((e=>{let[s]=e;return!!t.includes(s.toLowerCase())||(this.uppy.log(`[CompanionClient] excluding disallowed header ${s}`),!1)})))}async get(e,t){return void 0===t&&(t=void 0),"boolean"===typeof t&&(t={skipPostResponse:t}),d(this,v)[v]({...t,path:e})}async post(e,t,s){return void 0===s&&(s=void 0),"boolean"===typeof s&&(s={skipPostResponse:s}),d(this,v)[v]({...s,path:e,method:"POST",data:t})}async delete(e,t,s){return void 0===t&&(t=void 0),"boolean"===typeof s&&(s={skipPostResponse:s}),d(this,v)[v]({...s,path:e,method:"DELETE",data:t})}}function w(e){return/^(https?:|)\/\//.test(e)?e:`${this.hostname}/${e}`}async function P(e){let{path:t,method:s="GET",data:i,skipPostResponse:r,signal:o}=e;try{const e=await this.preflightAndHeaders(t),a=await function(){return fetch(...arguments).catch((e=>{throw"AbortError"===e.name?e:new n(e)}))}(d(this,y)[y](t),{method:s,signal:o,headers:e,credentials:this.opts.companionCookiesRule||"same-origin",body:i?JSON.stringify(i):null});return r||this.onReceiveResponse(a),async function(e){if(401===e.status)throw new u;const t=e.json();if(e.ok)return t;let s=`Failed request with status: ${e.status}. ${e.statusText}`;try{const e=await t;s=e.message?`${s} message: ${e.message}`:s,s=e.requestId?`${s} request-Id: ${e.requestId}`:s}catch{}throw new Error(s)}(a)}catch(a){if(null!=a&&a.isAuthError)throw a;throw new l(`Could not ${s} ${d(this,y)[y](t)}`,{cause:a})}}function S(e,t){return new Promise((s=>{localStorage.setItem(e,t),s()}))}function O(e){return Promise.resolve(localStorage.getItem(e))}function U(e){return new Promise((t=>{localStorage.removeItem(e),t()}))}b.VERSION="3.1.3";class E extends b{constructor(e,t){super(e,t),this.provider=t.provider,this.id=this.provider,this.name=this.opts.name||(e=>e.split("-").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" "))(this.id),this.pluginId=this.opts.pluginId,this.tokenKey=`companion-${this.pluginId}-auth-token`,this.companionKeysParams=this.opts.companionKeysParams,this.preAuthToken=null}async headers(){const[e,t]=await Promise.all([super.headers(),this.getAuthToken()]),s={};return t&&(s["uppy-auth-token"]=t),this.companionKeysParams&&(s["uppy-credentials-params"]=btoa(JSON.stringify({params:this.companionKeysParams}))),{...e,...s}}onReceiveResponse(e){super.onReceiveResponse(e);const t=this.uppy.getPlugin(this.pluginId),s=t.getPluginState().authenticated?401!==e.status:e.status<400;return t.setPluginState({authenticated:s}),e}setAuthToken(e){return this.uppy.getPlugin(this.pluginId).storage.setItem(this.tokenKey,e)}getAuthToken(){return this.uppy.getPlugin(this.pluginId).storage.getItem(this.tokenKey)}async ensurePreAuth(){if(this.companionKeysParams&&!this.preAuthToken&&(await this.fetchPreAuthToken(),!this.preAuthToken))throw new Error("Could not load authentication data required for third-party login. Please try again later.")}authUrl(e){void 0===e&&(e={});const t=new URLSearchParams(e);return this.preAuthToken&&t.set("uppyPreAuthToken",this.preAuthToken),`${this.hostname}/${this.id}/connect?${t}`}fileUrl(e){return`${this.hostname}/${this.id}/get/${e}`}async fetchPreAuthToken(){if(this.companionKeysParams)try{const e=await this.post(`${this.id}/preauth/`,{params:this.companionKeysParams});this.preAuthToken=e.token}catch(e){this.uppy.log(`[CompanionClient] unable to fetch preAuthToken ${e}`,"warning")}}list(e){return this.get(`${this.id}/list/${e||""}`)}logout(){return this.get(`${this.id}/logout`).then((e=>Promise.all([e,this.uppy.getPlugin(this.pluginId).storage.removeItem(this.tokenKey)]))).then((e=>{let[t]=e;return t}))}static initPlugin(e,t,s){if(e.type="acquirer",e.files=[],s&&(e.opts={...s,...t}),t.serverUrl||t.serverPattern)throw new Error("`serverUrl` and `serverPattern` have been renamed to `companionUrl` and `companionAllowedHosts` respectively in the 0.30.5 release. Please consult the docs (for example, https://uppy.io/docs/instagram/ for the Instagram plugin) and use the updated options.`");if(t.companionAllowedHosts){const s=t.companionAllowedHosts;if("string"!==typeof s&&!Array.isArray(s)&&!(s instanceof RegExp))throw new TypeError(`${e.id}: the option "companionAllowedHosts" must be one of string, Array, RegExp`);e.opts.companionAllowedHosts=s}else/^(?!https?:\/\/).*$/i.test(t.companionUrl)?e.opts.companionAllowedHosts=`https://${t.companionUrl.replace(/^\/\//,"")}`:e.opts.companionAllowedHosts=new URL(t.companionUrl).origin;e.storage=e.opts.storage||i}}var k=s(44800);let j,F;function T(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var R=0;function A(e){return"__private_"+R+++"_"+e}var $=A("queued"),C=A("emitter"),x=A("isOpen"),I=A("socket"),M=A("handleMessage");j=Symbol.for("uppy test: getSocket"),F=Symbol.for("uppy test: getQueued");class N{constructor(e){Object.defineProperty(this,$,{writable:!0,value:[]}),Object.defineProperty(this,C,{writable:!0,value:k()}),Object.defineProperty(this,x,{writable:!0,value:!1}),Object.defineProperty(this,I,{writable:!0,value:void 0}),Object.defineProperty(this,M,{writable:!0,value:e=>{try{const t=JSON.parse(e.data);this.emit(t.action,t.payload)}catch(t){console.log(t)}}}),this.opts=e,e&&!1===e.autoOpen||this.open()}get isOpen(){return T(this,x)[x]}[j](){return T(this,I)[I]}[F](){return T(this,$)[$]}open(){null==T(this,I)[I]&&(T(this,I)[I]=new WebSocket(this.opts.target),T(this,I)[I].onopen=()=>{for(T(this,x)[x]=!0;T(this,$)[$].length>0&&T(this,x)[x];){const e=T(this,$)[$].shift();this.send(e.action,e.payload)}},T(this,I)[I].onclose=()=>{T(this,x)[x]=!1,T(this,I)[I]=null},T(this,I)[I].onmessage=T(this,M)[M])}close(){var e;null==(e=T(this,I)[I])||e.close()}send(e,t){T(this,x)[x]?T(this,I)[I].send(JSON.stringify({action:e,payload:t})):T(this,$)[$].push({action:e,payload:t})}on(e,t){T(this,C)[C].on(e,t)}emit(e,t){T(this,C)[C].emit(e,t)}once(e,t){T(this,C)[C].once(e,t)}}function q(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var _=0;function z(e){return"__private_"+_+++"_"+e}var L=z("emitter"),H=z("events");class D{constructor(e){Object.defineProperty(this,L,{writable:!0,value:void 0}),Object.defineProperty(this,H,{writable:!0,value:[]}),q(this,L)[L]=e}on(e,t){return q(this,H)[H].push([e,t]),q(this,L)[L].on(e,t)}remove(){for(const[e,t]of q(this,H)[H].splice(0))q(this,L)[L].off(e,t)}}const B=s(23493)((function(e,t,s){const{progress:i,bytesUploaded:r,bytesTotal:o}=t;i&&(e.uppy.log(`Upload progress: ${i}`),e.uppy.emit("upload-progress",s,{uploader:e,bytesUploaded:r,bytesTotal:o}))}),300,{leading:!0,trailing:!0});function K(e){const t=/^(?:https?:\/\/|\/\/)?(?:[^@\n]+@)?(?:www\.)?([^\n]+)/i.exec(e)[1];return`${/^http:\/\//i.test(e)?"ws":"wss"}://${t}`}function V(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var W=0;function G(e){return"__private_"+W+++"_"+e}function X(e){if(null!=e){var t;const s=()=>this.abort(e.reason);e.addEventListener("abort",s,{once:!0});const i=()=>{e.removeEventListener("abort",s)};null==(t=this.then)||t.call(this,i,i)}return this}var Z=G("activeRequests"),J=G("queuedHandlers"),Y=G("paused"),Q=G("pauseTimer"),ee=G("downLimit"),te=G("upperLimit"),se=G("rateLimitingTimer"),ie=G("call"),re=G("queueNext"),oe=G("next"),ne=G("queue"),ae=G("dequeue"),le=G("resume"),pe=G("increaseLimit");class ue{constructor(e){Object.defineProperty(this,ae,{value:fe}),Object.defineProperty(this,ne,{value:me}),Object.defineProperty(this,oe,{value:ce}),Object.defineProperty(this,re,{value:de}),Object.defineProperty(this,ie,{value:he}),Object.defineProperty(this,Z,{writable:!0,value:0}),Object.defineProperty(this,J,{writable:!0,value:[]}),Object.defineProperty(this,Y,{writable:!0,value:!1}),Object.defineProperty(this,Q,{writable:!0,value:void 0}),Object.defineProperty(this,ee,{writable:!0,value:1}),Object.defineProperty(this,te,{writable:!0,value:void 0}),Object.defineProperty(this,se,{writable:!0,value:void 0}),Object.defineProperty(this,le,{writable:!0,value:()=>this.resume()}),Object.defineProperty(this,pe,{writable:!0,value:()=>{if(V(this,Y)[Y])V(this,se)[se]=setTimeout(V(this,pe)[pe],0);else{V(this,ee)[ee]=this.limit,this.limit=Math.ceil((V(this,te)[te]+V(this,ee)[ee])/2);for(let e=V(this,ee)[ee];e<=this.limit;e++)V(this,re)[re]();V(this,te)[te]-V(this,ee)[ee]>3?V(this,se)[se]=setTimeout(V(this,pe)[pe],2e3):V(this,ee)[ee]=Math.floor(V(this,ee)[ee]/2)}}}),this.limit="number"!==typeof e||0===e?1/0:e}run(e,t){return!V(this,Y)[Y]&&V(this,Z)[Z]<this.limit?V(this,ie)[ie](e):V(this,ne)[ne](e,t)}wrapSyncFunction(e,t){var s=this;return function(){for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];const n=s.run((()=>(e(...r),queueMicrotask((()=>n.done())),()=>{})),t);return{abortOn:X,abort(){n.abort()}}}}wrapPromiseFunction(e,t){var s=this;return function(){for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];let n;const a=new Promise(((i,o)=>{n=s.run((()=>{let t,s;try{s=Promise.resolve(e(...r))}catch(a){s=Promise.reject(a)}return s.then((e=>{t?o(t):(n.done(),i(e))}),(e=>{t?o(t):(n.done(),o(e))})),e=>{t=function(e){return new Error("Cancelled",{cause:e})}(e)}}),t)}));return a.abort=e=>{n.abort(e)},a.abortOn=X,a}}resume(){V(this,Y)[Y]=!1,clearTimeout(V(this,Q)[Q]);for(let e=0;e<this.limit;e++)V(this,re)[re]()}pause(e){void 0===e&&(e=null),V(this,Y)[Y]=!0,clearTimeout(V(this,Q)[Q]),null!=e&&(V(this,Q)[Q]=setTimeout(V(this,le)[le],e))}rateLimit(e){clearTimeout(V(this,se)[se]),this.pause(e),this.limit>1&&Number.isFinite(this.limit)&&(V(this,te)[te]=this.limit-1,this.limit=V(this,ee)[ee],V(this,se)[se]=setTimeout(V(this,pe)[pe],e))}get isPaused(){return V(this,Y)[Y]}}function he(e){V(this,Z)[Z]+=1;let t,s=!1;try{t=e()}catch(i){throw V(this,Z)[Z]-=1,i}return{abort:e=>{s||(s=!0,V(this,Z)[Z]-=1,t(e),V(this,re)[re]())},done:()=>{s||(s=!0,V(this,Z)[Z]-=1,V(this,re)[re]())}}}function de(){queueMicrotask((()=>V(this,oe)[oe]()))}function ce(){if(V(this,Y)[Y]||V(this,Z)[Z]>=this.limit)return;if(0===V(this,J)[J].length)return;const e=V(this,J)[J].shift(),t=V(this,ie)[ie](e.fn);e.abort=t.abort,e.done=t.done}function me(e,t){void 0===t&&(t={});const s={fn:e,priority:t.priority||0,abort:()=>{V(this,ae)[ae](s)},done:()=>{throw new Error("Cannot mark a queued request as done: this indicates a bug")}},i=V(this,J)[J].findIndex((e=>s.priority>e.priority));return-1===i?V(this,J)[J].push(s):V(this,J)[J].splice(i,0,s),s}function fe(e){const t=V(this,J)[J].indexOf(e);-1!==t&&V(this,J)[J].splice(t,1)}const ge=Symbol("__queue");function ye(e){return e.filter((e=>!(e=>"error"in e&&e.error)(e)))}function ve(e){return e.filter((e=>!e.progress.uploadStarted||!e.isRestored))}function be(e,t){return Object.prototype.hasOwnProperty.call(e,t)}const{AbortController:we}=globalThis,{AbortSignal:Pe}=globalThis,Se=function(e,t){void 0===e&&(e="Aborted");const s=new DOMException(e,"AbortError");return null!=t&&be(t,"cause")&&Object.defineProperty(s,"cause",{__proto__:null,configurable:!0,writable:!0,value:t.cause}),s};function Oe(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var Ue=0;function Ee(e){return"__private_"+Ue+++"_"+e}const ke={getChunkSize:e=>Math.ceil(e.size/1e4),onProgress(){},onPartComplete(){},onSuccess(){},onError(e){throw e}};const je=Symbol("pausing upload, not an actual error");var Fe=Ee("abortController"),Te=Ee("chunks"),Re=Ee("chunkState"),Ae=Ee("data"),$e=Ee("file"),Ce=Ee("uploadPromise"),xe=Ee("onError"),Ie=Ee("onSuccess"),Me=Ee("shouldUseMultipart"),Ne=Ee("onReject"),qe=Ee("maxMultipartParts"),_e=Ee("minPartSize"),ze=Ee("initChunks"),Le=Ee("createUpload"),He=Ee("resumeUpload"),De=Ee("onPartProgress"),Be=Ee("onPartComplete"),Ke=Ee("abortUpload");function Ve(){const e=Oe(this,Ae)[Ae].size,t="function"===typeof Oe(this,Me)[Me]?Oe(this,Me)[Me](Oe(this,$e)[$e]):Boolean(Oe(this,Me)[Me]);if(t&&e>Oe(this,_e)[_e]){let s=Math.max(this.options.getChunkSize(Oe(this,Ae)[Ae]),Oe(this,_e)[_e]),i=Math.floor(e/s);i>Oe(this,qe)[qe]&&(i=Oe(this,qe)[qe],s=e/Oe(this,qe)[qe]),Oe(this,Te)[Te]=Array(i);for(let r=0,o=0;r<e;r+=s,o++){const i=Math.min(e,r+s),n=()=>{const e=r;return Oe(this,Ae)[Ae].slice(e,i)};Oe(this,Te)[Te][o]={getData:n,onProgress:Oe(this,De)[De](o),onComplete:Oe(this,Be)[Be](o),shouldUseMultipart:t}}}else Oe(this,Te)[Te]=[{getData:()=>Oe(this,Ae)[Ae],onProgress:Oe(this,De)[De](0),onComplete:Oe(this,Be)[Be](0),shouldUseMultipart:t}];Oe(this,Re)[Re]=Oe(this,Te)[Te].map((()=>({uploaded:0})))}function We(){Oe(this,Ce)[Ce]=this.options.companionComm.uploadFile(Oe(this,$e)[$e],Oe(this,Te)[Te],Oe(this,Fe)[Fe].signal).then(Oe(this,Ie)[Ie],Oe(this,Ne)[Ne])}function Ge(){Oe(this,Ce)[Ce]=this.options.companionComm.resumeUploadFile(Oe(this,$e)[$e],Oe(this,Te)[Te],Oe(this,Fe)[Fe].signal).then(Oe(this,Ie)[Ie],Oe(this,Ne)[Ne])}function Xe(){Oe(this,Fe)[Fe].abort(),this.options.companionComm.abortFileUpload(Oe(this,$e)[$e]).catch((e=>this.options.log(e)))}const Ze=class{constructor(e,t){var s;Object.defineProperty(this,Ke,{value:Xe}),Object.defineProperty(this,He,{value:Ge}),Object.defineProperty(this,Le,{value:We}),Object.defineProperty(this,ze,{value:Ve}),Object.defineProperty(this,Fe,{writable:!0,value:new we}),Object.defineProperty(this,Te,{writable:!0,value:void 0}),Object.defineProperty(this,Re,{writable:!0,value:void 0}),Object.defineProperty(this,Ae,{writable:!0,value:void 0}),Object.defineProperty(this,$e,{writable:!0,value:void 0}),Object.defineProperty(this,Ce,{writable:!0,value:void 0}),Object.defineProperty(this,xe,{writable:!0,value:void 0}),Object.defineProperty(this,Ie,{writable:!0,value:void 0}),Object.defineProperty(this,Me,{writable:!0,value:void 0}),Object.defineProperty(this,Ne,{writable:!0,value:e=>(null==e?void 0:e.cause)===je?null:Oe(this,xe)[xe](e)}),Object.defineProperty(this,qe,{writable:!0,value:1e4}),Object.defineProperty(this,_e,{writable:!0,value:5242880}),Object.defineProperty(this,De,{writable:!0,value:e=>t=>{if(!t.lengthComputable)return;Oe(this,Re)[Re][e].uploaded=function(e){if("string"===typeof e)return parseInt(e,10);if("number"===typeof e)return e;throw new TypeError("Expected a number")}(t.loaded);const s=Oe(this,Re)[Re].reduce(((e,t)=>e+t.uploaded),0);this.options.onProgress(s,Oe(this,Ae)[Ae].size)}}),Object.defineProperty(this,Be,{writable:!0,value:e=>t=>{Oe(this,Te)[Te][e]=null,Oe(this,Re)[Re][e].etag=t,Oe(this,Re)[Re][e].done=!0;const s={PartNumber:e+1,ETag:t};this.options.onPartComplete(s)}}),this.options={...ke,...t},null!=(s=this.options).getChunkSize||(s.getChunkSize=ke.getChunkSize),Oe(this,Ae)[Ae]=e,Oe(this,$e)[$e]=t.file,Oe(this,Ie)[Ie]=this.options.onSuccess,Oe(this,xe)[xe]=this.options.onError,Oe(this,Me)[Me]=this.options.shouldUseMultipart,Oe(this,ze)[ze]()}start(){Oe(this,Ce)[Ce]?(Oe(this,Fe)[Fe].signal.aborted||Oe(this,Fe)[Fe].abort(je),Oe(this,Fe)[Fe]=new we,Oe(this,He)[He]()):Oe(this,Le)[Le]()}pause(){Oe(this,Fe)[Fe].abort(je),Oe(this,Fe)[Fe]=new we}abort(e){var t;void 0===e&&(e=void 0),null!=(t=e)&&t.really?Oe(this,Ke)[Ke]():this.pause()}get chunkState(){return Oe(this,Re)[Re]}};let Je;function Ye(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var Qe=0;function et(e){return"__private_"+Qe+++"_"+e}function tt(e){if(e&&e.error){const t=new Error(e.message);throw Object.assign(t,e.error),t}return e}function st(e){let{meta:t,allowedMetaFields:s,querify:i=!1}=e;const r=null!=s?s:Object.keys(t);return t?Object.fromEntries(r.filter((e=>null!=t[e])).map((e=>[i?`metadata[${e}]`:e,String(t[e])]))):{}}function it(e){if(null!=e&&e.aborted)throw Se("The operation was aborted",{cause:e.reason})}var rt=et("abortMultipartUpload"),ot=et("cache"),nt=et("createMultipartUpload"),at=et("fetchSignature"),lt=et("getUploadParameters"),pt=et("listParts"),ut=et("previousRetryDelay"),ht=et("requests"),dt=et("retryDelayIterator"),ct=et("sendCompletionRequest"),mt=et("setS3MultipartState"),ft=et("uploadPartBytes"),gt=et("shouldRetry"),yt=et("nonMultipartUpload");class vt{constructor(e,t,s){Object.defineProperty(this,yt,{value:wt}),Object.defineProperty(this,gt,{value:bt}),Object.defineProperty(this,rt,{writable:!0,value:void 0}),Object.defineProperty(this,ot,{writable:!0,value:new WeakMap}),Object.defineProperty(this,nt,{writable:!0,value:void 0}),Object.defineProperty(this,at,{writable:!0,value:void 0}),Object.defineProperty(this,lt,{writable:!0,value:void 0}),Object.defineProperty(this,pt,{writable:!0,value:void 0}),Object.defineProperty(this,ut,{writable:!0,value:void 0}),Object.defineProperty(this,ht,{writable:!0,value:void 0}),Object.defineProperty(this,dt,{writable:!0,value:void 0}),Object.defineProperty(this,ct,{writable:!0,value:void 0}),Object.defineProperty(this,mt,{writable:!0,value:void 0}),Object.defineProperty(this,ft,{writable:!0,value:void 0}),Ye(this,ht)[ht]=e,Ye(this,mt)[mt]=s,this.setOptions(t)}setOptions(e){const t=Ye(this,ht)[ht];var s;("abortMultipartUpload"in e&&(Ye(this,rt)[rt]=t.wrapPromiseFunction(e.abortMultipartUpload)),"createMultipartUpload"in e&&(Ye(this,nt)[nt]=t.wrapPromiseFunction(e.createMultipartUpload,{priority:-1})),"signPart"in e&&(Ye(this,at)[at]=t.wrapPromiseFunction(e.signPart)),"listParts"in e&&(Ye(this,pt)[pt]=t.wrapPromiseFunction(e.listParts)),"completeMultipartUpload"in e&&(Ye(this,ct)[ct]=t.wrapPromiseFunction(e.completeMultipartUpload)),"retryDelays"in e)&&(Ye(this,dt)[dt]=null==(s=e.retryDelays)?void 0:s.values());"uploadPartBytes"in e&&(Ye(this,ft)[ft]=t.wrapPromiseFunction(e.uploadPartBytes,{priority:1/0})),"getUploadParameters"in e&&(Ye(this,lt)[lt]=t.wrapPromiseFunction(e.getUploadParameters))}async getUploadId(e,t){let s;for(;null!=(s=Ye(this,ot)[ot].get(e.data));)try{return await s}catch{}const i=Ye(this,nt)[nt](e,t),r=()=>{i.abort(t.reason),Ye(this,ot)[ot].delete(e.data)};return t.addEventListener("abort",r,{once:!0}),Ye(this,ot)[ot].set(e.data,i),i.then((async s=>{t.removeEventListener("abort",r),Ye(this,mt)[mt](e,s),Ye(this,ot)[ot].set(e.data,s)}),(()=>{t.removeEventListener("abort",r),Ye(this,ot)[ot].delete(e.data)})),i}async abortFileUpload(e){const t=Ye(this,ot)[ot].get(e.data);if(null==t)return;let s;try{s=await t}catch{return}await Ye(this,rt)[rt](e,s)}async uploadFile(e,t,s){if(it(s),1===t.length&&!t[0].shouldUseMultipart)return Ye(this,yt)[yt](e,t[0],s);const{uploadId:i,key:r}=await this.getUploadId(e,s);it(s);try{const o=await Promise.all(t.map(((t,i)=>this.uploadChunk(e,i+1,t,s))));return it(s),await Ye(this,ct)[ct](e,{key:r,uploadId:i,parts:o,signal:s}).abortOn(s)}catch(o){throw Ye(this,ot)[ot].delete(e.data),o}}async resumeUploadFile(e,t,s){if(it(s),1===t.length)return Ye(this,yt)[yt](e,t[0],s);const{uploadId:i,key:r}=await this.getUploadId(e,s);it(s);const o=await Ye(this,pt)[pt](e,{uploadId:i,key:r,signal:s}).abortOn(s);it(s);const n=await Promise.all(t.map(((t,i)=>{const r=i+1,n=o.find((e=>{let{PartNumber:t}=e;return t===r}));return null==n?this.uploadChunk(e,r,t,s):{PartNumber:r,ETag:n.ETag}})));return it(s),Ye(this,ct)[ct](e,{key:r,uploadId:i,parts:n,signal:s}).abortOn(s)}async uploadChunk(e,t,s,i){it(i);const{uploadId:r,key:o}=await this.getUploadId(e,i);for(it(i);;){const a=s.getData(),{onProgress:l,onComplete:p}=s,u=await Ye(this,at)[at](e,{uploadId:r,key:o,partNumber:t,body:a,signal:i}).abortOn(i);it(i);try{return{PartNumber:t,...await Ye(this,ft)[ft]({signature:u,body:a,size:a.size,onProgress:l,onComplete:p,signal:i}).abortOn(i)}}catch(n){if(!await Ye(this,gt)[gt](n))throw n}}}}async function bt(e){var t;const s=Ye(this,ht)[ht],i=null==e||null==(t=e.source)?void 0:t.status;if(null==i)return!1;if(403===i&&"Request has expired"===e.message){if(!s.isPaused){if(1===s.limit||null==Ye(this,ut)[ut]){var r;const e=null==(r=Ye(this,dt)[dt])?void 0:r.next();if(null==e||e.done)return!1;Ye(this,ut)[ut]=e.value}s.rateLimit(0),await new Promise((e=>setTimeout(e,Ye(this,ut)[ut])))}}else if(429===i){if(!s.isPaused){var o;const e=null==(o=Ye(this,dt)[dt])?void 0:o.next();if(null==e||e.done)return!1;s.rateLimit(e.value)}}else{if(i>400&&i<500&&409!==i)return!1;if("undefined"!==typeof navigator&&!1===navigator.onLine)s.isPaused||(s.pause(),window.addEventListener("online",(()=>{s.resume()}),{once:!0}));else{var n;const e=null==(n=Ye(this,dt)[dt])?void 0:n.next();if(null==e||e.done)return!1;await new Promise((t=>setTimeout(t,e.value)))}}return!0}async function wt(e,t,s){const{method:i="post",url:r,fields:o,headers:n}=await Ye(this,lt)[lt](e,{signal:s}).abortOn(s),a=new FormData;Object.entries(o).forEach((e=>{let[t,s]=e;return a.set(t,s)}));const l=t.getData();a.set("file",l);const{onProgress:p,onComplete:u}=t;return Ye(this,ft)[ft]({signature:{url:r,headers:n,method:i},body:a,size:l.size,onProgress:p,onComplete:u,signal:s}).abortOn(s)}var Pt=et("queueRequestSocketToken"),St=et("companionCommunicationQueue"),Ot=et("client"),Ut=et("setS3MultipartState"),Et=et("uploadFile"),kt=et("requestSocketToken"),jt=et("uploadRemote"),Ft=et("upload"),Tt=et("setCompanionHeaders");Je=Symbol.for("uppy test: getClient");class Rt extends r.Z{constructor(e,t){var s;super(e,t),Object.defineProperty(this,jt,{value:$t}),Object.defineProperty(this,Et,{value:At}),Object.defineProperty(this,Pt,{writable:!0,value:void 0}),Object.defineProperty(this,St,{writable:!0,value:void 0}),Object.defineProperty(this,Ot,{writable:!0,value:void 0}),Object.defineProperty(this,Ut,{writable:!0,value:(e,t)=>{let{key:s,uploadId:i}=t;const r=this.uppy.getFile(e.id);this.uppy.setFileState(e.id,{s3Multipart:{...r.s3Multipart,key:s,uploadId:i}})}}),Object.defineProperty(this,kt,{writable:!0,value:async(e,t)=>{const s=new(e.remote.providerOptions.provider?E:b)(this.uppy,e.remote.providerOptions),i={...this.opts};if(e.tus&&Object.assign(i,e.tus),null==e.remote.url)throw new Error("Cannot connect to an undefined URL");return(await s.post(e.remote.url,{...e.remote.body,protocol:"s3-multipart",size:e.data.size,metadata:e.meta},t)).token}}),Object.defineProperty(this,Ft,{writable:!0,value:async e=>{if(0===e.length)return;const t=ye(this.uppy.getFilesByIds(e)),s=ve(t);this.uppy.emit("upload-start",s);const i=t.map((e=>{if(e.isRemote){const t=new AbortController,s=s=>{s.id===e.id&&t.abort()};this.uppy.on("file-removed",s);const i=Ye(this,jt)[jt](e,{signal:t.signal});return this.requests.wrapSyncFunction((()=>{this.uppy.off("file-removed",s)}),{priority:-1})(),i}return Ye(this,Et)[Et](e)}));return Promise.all(i)}}),Object.defineProperty(this,Tt,{writable:!0,value:()=>{Ye(this,Ot)[Ot].setCompanionHeaders(this.opts.companionHeaders)}}),this.type="uploader",this.id=this.opts.id||"AwsS3Multipart",this.title="AWS S3 Multipart",Ye(this,Ot)[Ot]=new b(e,t);const i={allowedMetaFields:null,limit:6,shouldUseMultipart:e=>0!==e.size,retryDelays:[0,1e3,3e3,5e3],createMultipartUpload:this.createMultipartUpload.bind(this),listParts:this.listParts.bind(this),abortMultipartUpload:this.abortMultipartUpload.bind(this),completeMultipartUpload:this.completeMultipartUpload.bind(this),signPart:this.signPart.bind(this),uploadPartBytes:Rt.uploadPartBytes,getUploadParameters:this.getUploadParameters.bind(this),companionHeaders:{}};this.opts={...i,...t},null!=(null==t?void 0:t.prepareUploadParts)&&null==t.signPart&&(this.opts.signPart=async(e,s)=>{let{uploadId:i,key:r,partNumber:o,body:n,signal:a}=s;const{presignedUrls:l,headers:p}=await t.prepareUploadParts(e,{uploadId:i,key:r,parts:[{number:o,chunk:n}],signal:a});return{url:null==l?void 0:l[o],headers:null==p?void 0:p[o]}}),this.requests=null!=(s=this.opts.rateLimitedQueue)?s:new ue(this.opts.limit),Ye(this,St)[St]=new vt(this.requests,this.opts,Ye(this,Ut)[Ut]),this.uploaders=Object.create(null),this.uploaderEvents=Object.create(null),this.uploaderSockets=Object.create(null),Ye(this,Pt)[Pt]=this.requests.wrapPromiseFunction(Ye(this,kt)[kt],{priority:-1})}[Je](){return Ye(this,Ot)[Ot]}setOptions(e){return Ye(this,St)[St].setOptions(e),super.setOptions(e)}resetUploaderReferences(e,t){void 0===t&&(t={}),this.uploaders[e]&&(this.uploaders[e].abort({really:t.abort||!1}),this.uploaders[e]=null),this.uploaderEvents[e]&&(this.uploaderEvents[e].remove(),this.uploaderEvents[e]=null),this.uploaderSockets[e]&&(this.uploaderSockets[e].close(),this.uploaderSockets[e]=null)}assertHost(e){if(!this.opts.companionUrl)throw new Error(`Expected a \`companionUrl\` option containing a Companion address, or if you are not using Companion, a custom \`${e}\` implementation.`)}createMultipartUpload(e,t){this.assertHost("createMultipartUpload"),it(t);const s=st({meta:e.meta,allowedMetaFields:this.opts.allowedMetaFields});return Ye(this,Ot)[Ot].post("s3/multipart",{filename:e.name,type:e.type,metadata:s},{signal:t}).then(tt)}listParts(e,t,s){let{key:i,uploadId:r}=t;this.assertHost("listParts"),it(s);const o=encodeURIComponent(i);return Ye(this,Ot)[Ot].get(`s3/multipart/${r}?key=${o}`,{signal:s}).then(tt)}completeMultipartUpload(e,t,s){let{key:i,uploadId:r,parts:o}=t;this.assertHost("completeMultipartUpload"),it(s);const n=encodeURIComponent(i),a=encodeURIComponent(r);return Ye(this,Ot)[Ot].post(`s3/multipart/${a}/complete?key=${n}`,{parts:o},{signal:s}).then(tt)}signPart(e,t){let{uploadId:s,key:i,partNumber:r,signal:o}=t;if(this.assertHost("signPart"),it(o),null==s||null==i||null==r)throw new Error("Cannot sign without a key, an uploadId, and a partNumber");const n=encodeURIComponent(i);return Ye(this,Ot)[Ot].get(`s3/multipart/${s}/${r}?key=${n}`,{signal:o}).then(tt)}abortMultipartUpload(e,t,s){let{key:i,uploadId:r}=t;this.assertHost("abortMultipartUpload");const o=encodeURIComponent(i),n=encodeURIComponent(r);return Ye(this,Ot)[Ot].delete(`s3/multipart/${n}?key=${o}`,void 0,{signal:s}).then(tt)}getUploadParameters(e,t){const{meta:s}=e,{type:i,name:r}=s,o=st({meta:s,allowedMetaFields:this.opts.allowedMetaFields,querify:!0}),n=new URLSearchParams({filename:r,type:i,...o});return Ye(this,Ot)[Ot].get(`s3/params?${n}`,t)}static async uploadPartBytes(e){let{signature:{url:t,expires:s,headers:i,method:r="PUT"},body:o,size:n=o.size,onProgress:a,onComplete:l,signal:p}=e;if(it(p),null==t)throw new Error("Cannot upload to an undefined URL");return new Promise(((e,u)=>{const h=new XMLHttpRequest;function d(){h.abort()}function c(){p.removeEventListener("abort",d)}h.open(r,t,!0),i&&Object.keys(i).forEach((e=>{h.setRequestHeader(e,i[e])})),h.responseType="text","number"===typeof s&&(h.timeout=1e3*s),p.addEventListener("abort",d),h.upload.addEventListener("progress",(e=>{a(e)})),h.addEventListener("abort",(()=>{c(),u(Se())})),h.addEventListener("timeout",(()=>{c();const e=new Error("Request has expired");e.source={status:403},u(e)})),h.addEventListener("load",(t=>{if(c(),403===t.target.status&&t.target.responseText.includes("<Message>Request has expired</Message>")){const e=new Error("Request has expired");return e.source=t.target,void u(e)}if(t.target.status<200||t.target.status>=300){const e=new Error("Non 2xx");return e.source=t.target,void u(e)}null==a||a({loaded:n,lengthComputable:!0});const s=t.target.getResponseHeader("ETag");null!==s?(null==l||l(s),e({ETag:s})):u(new Error("AwsS3/Multipart: Could not read the ETag header. This likely means CORS is not configured correctly on the S3 Bucket. See https://uppy.io/docs/aws-s3-multipart#S3-Bucket-Configuration for instructions."))})),h.addEventListener("error",(e=>{c();const t=new Error("Unknown error");t.source=e.target,u(t)})),h.send(o)}))}async connectToServerSocket(e){var t=this;return new Promise(((s,i)=>{let r;const o=e.serverToken,n=K(e.remote.companionUrl),a=new N({target:`${n}/api/${o}`,autoOpen:!1});this.uploaderSockets[e.id]=a,this.uploaderEvents[e.id]=new D(this.uppy),this.onFileRemove(e.id,(()=>{a.send("cancel",{}),r.abort(),this.resetUploaderReferences(e.id,{abort:!0}),s(`upload ${e.id} was removed`)})),this.onFilePause(e.id,(e=>{e?(a.send("pause",{}),r.abort()):(r.abort(),r=this.requests.run((()=>(a.open(),a.send("resume",{}),()=>{}))))})),this.onPauseAll(e.id,(()=>{a.send("pause",{}),r.abort()})),this.onCancelAll(e.id,(function(i){let{reason:o}=void 0===i?{}:i;"user"===o&&(a.send("cancel",{}),r.abort(),t.resetUploaderReferences(e.id)),s(`upload ${e.id} was canceled`)})),this.onResumeAll(e.id,(()=>{r.abort(),e.error&&a.send("pause",{}),r=this.requests.run((()=>(a.open(),a.send("resume",{}),()=>{})))})),this.onRetry(e.id,(()=>{a.isOpen&&(a.send("pause",{}),a.send("resume",{}))})),this.onRetryAll(e.id,(()=>{a.isOpen&&(a.send("pause",{}),a.send("resume",{}))})),a.on("progress",(t=>B(this,t,e))),a.on("error",(t=>{this.uppy.emit("upload-error",e,new Error(t.error)),this.resetUploaderReferences(e.id),a.close(),r.done(),i(new Error(t.error))})),a.on("success",(t=>{const i={uploadURL:t.url};this.uppy.emit("upload-success",e,i),this.resetUploaderReferences(e.id),a.close(),r.done(),s()})),r=this.requests.run((()=>(e.isPaused?a.send("pause",{}):a.open(),()=>{})))}))}onFileRemove(e,t){this.uploaderEvents[e].on("file-removed",(s=>{e===s.id&&t(s.id)}))}onFilePause(e,t){this.uploaderEvents[e].on("upload-pause",((s,i)=>{e===s&&t(i)}))}onRetry(e,t){this.uploaderEvents[e].on("upload-retry",(s=>{e===s&&t()}))}onRetryAll(e,t){this.uploaderEvents[e].on("retry-all",(()=>{this.uppy.getFile(e)&&t()}))}onPauseAll(e,t){this.uploaderEvents[e].on("pause-all",(()=>{this.uppy.getFile(e)&&t()}))}onCancelAll(e,t){var s=this;this.uploaderEvents[e].on("cancel-all",(function(){s.uppy.getFile(e)&&t(...arguments)}))}onResumeAll(e,t){this.uploaderEvents[e].on("resume-all",(()=>{this.uppy.getFile(e)&&t()}))}install(){const{capabilities:e}=this.uppy.getState();this.uppy.setState({capabilities:{...e,resumableUploads:!0}}),this.uppy.addPreProcessor(Ye(this,Tt)[Tt]),this.uppy.addUploader(Ye(this,Ft)[Ft])}uninstall(){const{capabilities:e}=this.uppy.getState();this.uppy.setState({capabilities:{...e,resumableUploads:!1}}),this.uppy.removePreProcessor(Ye(this,Tt)[Tt]),this.uppy.removeUploader(Ye(this,Ft)[Ft])}}function At(e){var t=this;return new Promise(((s,i)=>{const r=()=>this.uppy.getFile(e.id)||e,o=new Ze(e.data,{companionComm:Ye(this,St)[St],log:function(){return t.uppy.log(...arguments)},getChunkSize:this.opts.getChunkSize?this.opts.getChunkSize.bind(this):null,onProgress:(t,s)=>{this.uppy.emit("upload-progress",e,{uploader:this,bytesUploaded:t,bytesTotal:s})},onError:t=>{this.uppy.log(t),this.uppy.emit("upload-error",e,t),this.resetUploaderReferences(e.id),i(t)},onSuccess:t=>{const i={body:{...t},uploadURL:t.location};this.resetUploaderReferences(e.id),this.uppy.emit("upload-success",r(),i),t.location&&this.uppy.log(`Download ${e.name} from ${t.location}`),s()},onPartComplete:e=>{this.uppy.emit("s3-multipart:part-uploaded",r(),e)},file:e,shouldUseMultipart:this.opts.shouldUseMultipart,...e.s3Multipart});this.uploaders[e.id]=o,this.uploaderEvents[e.id]=new D(this.uppy),this.onFileRemove(e.id,(t=>{o.abort(),this.resetUploaderReferences(e.id,{abort:!0}),s(`upload ${t.id} was removed`)})),this.onCancelAll(e.id,(function(i){let{reason:r}=void 0===i?{}:i;"user"===r&&(o.abort(),t.resetUploaderReferences(e.id,{abort:!0})),s(`upload ${e.id} was canceled`)})),this.onFilePause(e.id,(e=>{e?o.pause():o.start()})),this.onPauseAll(e.id,(()=>{o.pause()})),this.onResumeAll(e.id,(()=>{o.start()})),o.start()}))}async function $t(e,t){this.resetUploaderReferences(e.id);try{if(e.serverToken)return await this.connectToServerSocket(e);const s=await Ye(this,Pt)[Pt](e,t).abortOn(null==t?void 0:t.signal);if(!this.uppy.getState().files[e.id])return;return this.uppy.setFileState(e.id,{serverToken:s}),await this.connectToServerSocket(this.uppy.getFile(e.id))}catch(i){var s;if("AbortError"!==(null==i||null==(s=i.cause)?void 0:s.name))throw this.uppy.setFileState(e.id,{serverToken:void 0}),this.uppy.emit("upload-error",e,i),i;return}}Rt.VERSION="3.4.0";function Ct(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var xt=0;function It(e){return"__private_"+xt+++"_"+e}var Mt=It("aliveTimer"),Nt=It("isDone"),qt=It("onTimedOut"),_t=It("timeout");const zt=class{constructor(e,t){Object.defineProperty(this,Mt,{writable:!0,value:void 0}),Object.defineProperty(this,Nt,{writable:!0,value:!1}),Object.defineProperty(this,qt,{writable:!0,value:void 0}),Object.defineProperty(this,_t,{writable:!0,value:void 0}),Ct(this,_t)[_t]=e,Ct(this,qt)[qt]=t}progress(){Ct(this,Nt)[Nt]||Ct(this,_t)[_t]>0&&(clearTimeout(Ct(this,Mt)[Mt]),Ct(this,Mt)[Mt]=setTimeout(Ct(this,qt)[qt],Ct(this,_t)[_t]))}done(){Ct(this,Nt)[Nt]||(clearTimeout(Ct(this,Mt)[Mt]),Ct(this,Mt)[Mt]=null,Ct(this,Nt)[Nt]=!0)}};class Lt extends Error{constructor(e,t){void 0===t&&(t={}),super(e),this.cause=t.cause,this.cause&&be(this.cause,"isNetworkError")&&(this.isNetworkError=this.cause.isNetworkError)}}const Ht=Lt;class Dt extends Error{constructor(e,t){void 0===t&&(t=null),super("This looks like a network error, the endpoint might be blocked by an internet provider or a firewall."),this.cause=e,this.isNetworkError=!0,this.request=t}}const Bt=Dt;const Kt=function(e){return!!e&&(0!==e.readyState&&4!==e.readyState||0===e.status)};function Vt(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var Wt=0;function Gt(e){return"__private_"+Wt+++"_"+e}function Xt(e,t){if(Kt(e))return new Bt(t,e);const s=new Ht("Upload error",{cause:t});return s.request=e,s}function Zt(e,t){const s=new FormData;!function(e,t,s){(Array.isArray(s.allowedMetaFields)?s.allowedMetaFields:Object.keys(t)).forEach((s=>{e.append(s,t[s])}))}(s,e.meta,t);const i=function(e){return e.data.slice(0,e.data.size,e.meta.type)}(e);return e.name?s.append(t.fieldName,i,e.meta.name):s.append(t.fieldName,i),s}var Jt=Gt("queueRequestSocketToken"),Yt=Gt("getOptions"),Qt=Gt("addEventHandlerForFile"),es=Gt("addEventHandlerIfFileStillExists"),ts=Gt("uploadLocalFile"),ss=Gt("requestSocketToken"),is=Gt("uploadRemoteFile");class rs{constructor(e,t){Object.defineProperty(this,is,{value:ps}),Object.defineProperty(this,ts,{value:ls}),Object.defineProperty(this,es,{value:as}),Object.defineProperty(this,Qt,{value:ns}),Object.defineProperty(this,Yt,{value:os}),Object.defineProperty(this,Jt,{writable:!0,value:void 0}),Object.defineProperty(this,ss,{writable:!0,value:async e=>{const t=Vt(this,Yt)[Yt](e),s=new(e.remote.providerOptions.provider?E:b)(this.uppy,e.remote.providerOptions),i=Array.isArray(t.allowedMetaFields)?t.allowedMetaFields:Object.keys(e.meta);e.tus&&Object.assign(t,e.tus);return(await s.post(e.remote.url,{...e.remote.body,protocol:"multipart",endpoint:t.endpoint,size:e.data.size,fieldname:t.fieldName,metadata:Object.fromEntries(i.map((t=>[t,e.meta[t]]))),httpMethod:t.method,useFormData:t.formData,headers:t.headers})).token}}),this.uppy=e,this.opts={validateStatus:e=>e>=200&&e<300,...t},this.requests=t[ge],this.uploaderEvents=Object.create(null),this.i18n=t.i18n,Vt(this,Jt)[Jt]=this.requests.wrapPromiseFunction(Vt(this,ss)[ss],{priority:-1})}uploadFile(e,t,s){const i=this.uppy.getFile(e);if(this.uppy.log(`uploading ${t} of ${s}`),i.error)throw new Error(i.error);if(i.isRemote){const e=new AbortController,t=t=>{t.id===i.id&&e.abort()};this.uppy.on("file-removed",t);const s=Vt(this,is)[is](i,{signal:e.signal});return this.requests.wrapSyncFunction((()=>{this.uppy.off("file-removed",t)}),{priority:-1})(),s}return Vt(this,ts)[ts](i,t,s)}async connectToServerSocket(e){return new Promise(((t,s)=>{const i=Vt(this,Yt)[Yt](e),r=e.serverToken,o=K(e.remote.companionUrl);let n;const a=()=>{null==n&&(n=new N({target:`${o}/api/${r}`}),n.on("progress",(t=>B(this,t,e))),n.on("success",(s=>{const r=i.getResponseData(s.response.responseText,s.response),o=r[i.responseUrlFieldName],a={status:s.response.status,body:r,uploadURL:o,bytesUploaded:s.bytesUploaded};return this.uppy.emit("upload-success",e,a),l.done(),n.close(),this.uploaderEvents[e.id]&&(this.uploaderEvents[e.id].remove(),this.uploaderEvents[e.id]=null),t()})),n.on("error",(t=>{const r=t.response,o=r?i.getResponseError(r.responseText,r):new Ht(t.error.message,{cause:t.error});this.uppy.emit("upload-error",e,o),l.done(),this.uploaderEvents[e.id]&&(this.uploaderEvents[e.id].remove(),this.uploaderEvents[e.id]=null),s(o)})))};this.uploaderEvents[e.id]=new D(this.uppy);let l=this.requests.run((()=>{var t;e.isPaused?null==(t=n)||t.send("pause",{}):a();return()=>n.close()}));Vt(this,Qt)[Qt]("file-removed",e.id,(()=>{var s;null==(s=n)||s.send("cancel",{}),l.abort(),t(`upload ${e.id} was removed`)})),Vt(this,es)[es]("cancel-all",e.id,(function(s){let{reason:i}=void 0===s?{}:s;var r;"user"===i&&(null==(r=n)||r.send("cancel",{}),l.abort());t(`upload ${e.id} was canceled`)}));const p=()=>{null==n?l.abort():(n.send("pause",{}),l.done()),l=this.requests.run((()=>(e.isPaused||(null==n?a():n.send("resume",{})),()=>n.close())))};Vt(this,Qt)[Qt]("upload-retry",e.id,p),Vt(this,es)[es]("retry-all",e.id,p)})).catch((t=>(this.uppy.emit("upload-error",e,t),Promise.reject(t))))}}function os(e){var t;const{uppy:s}=this,i=s.getState().xhrUpload;return{...this.opts,...i||{},...e.xhrUpload||{},headers:{...this.opts.headers,...null==i?void 0:i.headers,...null==(t=e.xhrUpload)?void 0:t.headers}}}function ns(e,t,s){this.uploaderEvents[t].on(e,(e=>{var i;const r=null!=(i=null==e?void 0:e.id)?i:e;t===r&&s()}))}function as(e,t,s){var i=this;this.uploaderEvents[t].on(e,(function(){i.uppy.getFile(t)&&s(...arguments)}))}function ls(e){const t=Vt(this,Yt)[Yt](e);return new Promise(((s,i)=>{const r=t.formData?Zt(e,t):(e=>e.data)(e),o=new XMLHttpRequest;this.uploaderEvents[e.id]=new D(this.uppy);const n=new zt(t.timeout,(()=>{o.abort(),l.done();const s=new Error(this.i18n("timedOut",{seconds:Math.ceil(t.timeout/1e3)}));this.uppy.emit("upload-error",e,s),i(s)})),a=((e=21)=>{let t="",s=e;for(;s--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[64*Math.random()|0];return t})();o.upload.addEventListener("loadstart",(()=>{this.uppy.log(`[AwsS3/XHRUpload] ${a} started`)})),o.upload.addEventListener("progress",(t=>{this.uppy.log(`[AwsS3/XHRUpload] ${a} progress: ${t.loaded} / ${t.total}`),n.progress(),t.lengthComputable&&this.uppy.emit("upload-progress",e,{uploader:this,bytesUploaded:t.loaded,bytesTotal:t.total})})),o.addEventListener("load",(r=>{if(this.uppy.log(`[AwsS3/XHRUpload] ${a} finished`),n.done(),l.done(),this.uploaderEvents[e.id]&&(this.uploaderEvents[e.id].remove(),this.uploaderEvents[e.id]=null),t.validateStatus(r.target.status,o.responseText,o)){const i=t.getResponseData(o.responseText,o),n=i[t.responseUrlFieldName],a={status:r.target.status,body:i,uploadURL:n};return this.uppy.emit("upload-success",e,a),n&&this.uppy.log(`Download ${e.name} from ${n}`),s(e)}const p=t.getResponseData(o.responseText,o),u=Xt(o,t.getResponseError(o.responseText,o)),h={status:r.target.status,body:p};return this.uppy.emit("upload-error",e,u,h),i(u)})),o.addEventListener("error",(()=>{this.uppy.log(`[AwsS3/XHRUpload] ${a} errored`),n.done(),l.done(),this.uploaderEvents[e.id]&&(this.uploaderEvents[e.id].remove(),this.uploaderEvents[e.id]=null);const s=Xt(o,t.getResponseError(o.responseText,o));return this.uppy.emit("upload-error",e,s),i(s)})),o.open(t.method.toUpperCase(),t.endpoint,!0),o.withCredentials=Boolean(t.withCredentials),""!==t.responseType&&(o.responseType=t.responseType),Object.keys(t.headers).forEach((e=>{o.setRequestHeader(e,t.headers[e])}));const l=this.requests.run((()=>(o.send(r),()=>{n.done(),o.abort()})),{priority:1});Vt(this,Qt)[Qt]("file-removed",e.id,(()=>{l.abort(),i(new Error("File removed"))})),Vt(this,es)[es]("cancel-all",e.id,(function(e){let{reason:t}=void 0===e?{}:e;"user"===t&&l.abort(),i(new Error("Upload cancelled"))}))}))}async function ps(e,t){try{if(e.serverToken)return await this.connectToServerSocket(e);const s=await Vt(this,Jt)[Jt](e,t).abortOn(null==t?void 0:t.signal);if(!this.uppy.getState().files[e.id])return;return this.uppy.setFileState(e.id,{serverToken:s}),await this.connectToServerSocket(this.uppy.getFile(e.id))}catch(i){var s;if("AbortError"!==(null==i||null==(s=i.cause)?void 0:s.name))throw this.uppy.setFileState(e.id,{serverToken:void 0}),this.uppy.emit("upload-error",e,i),i;return}}const us=function(e,t){const s=t.headers?t.headers["content-type"]:t.getResponseHeader("Content-Type");if("string"===typeof s){const t=(i=s,i.replace(/;.*$/,"")).toLowerCase();if("application/xml"===t||"text/xml"===t)return!0;if("text/html"===t&&/^<\?xml /.test(e))return!0}var i;return!1},hs={strings:{timedOut:"Upload stalled for %{seconds} seconds, aborting."}};let ds;function cs(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var ms=0;function fs(e){return"__private_"+ms+++"_"+e}function gs(e,t){const s=e.indexOf(`<${t}>`),i=e.indexOf(`</${t}>`,s);return-1!==s&&-1!==i?e.slice(s+t.length+2,i):""}function ys(e){if(e&&e.error){const t=new Error(e.message);throw Object.assign(t,e.error),t}return e}function vs(e,t){if(!us(e,t))return;const s=gs(e,"Message");return new Error(s)}let bs=!1;var ws=fs("client"),Ps=fs("requests"),Ss=fs("uploader"),Os=fs("handleUpload"),Us=fs("setCompanionHeaders");ds=Symbol.for("uppy test: getClient");class Es extends r.Z{constructor(e,t){if(null!=(null==t?void 0:t.shouldUseMultipart))return new Rt(e,t);super(e,t),Object.defineProperty(this,ws,{writable:!0,value:void 0}),Object.defineProperty(this,Ps,{writable:!0,value:void 0}),Object.defineProperty(this,Ss,{writable:!0,value:void 0}),Object.defineProperty(this,Os,{writable:!0,value:async e=>{const t=Object.create(null);function s(e){var s;const{id:i}=e;null==(s=t[i])||s.abort()}this.uppy.on("file-removed",s);const i=ve(ye(this.uppy.getFilesByIds(e)));this.uppy.emit("upload-start",i);const r=cs(this,Ps)[Ps].wrapPromiseFunction((e=>this.opts.getUploadParameters(e))),o=e.length;return Promise.allSettled(e.map(((e,s)=>(t[e]=r(this.uppy.getFile(e)),t[e].then((i=>{delete t[e];const r=this.uppy.getFile(e);!function(e,t){if(null==t||"string"!==typeof t.url||"object"!==typeof t.fields&&null!=t.fields)throw new TypeError(`AwsS3: got incorrect result from 'getUploadParameters()' for file '${e.name}', expected an object '{ url, method, fields, headers }' but got '${JSON.stringify(t)}' instead.\nSee https://uppy.io/docs/aws-s3/#getUploadParameters-file for more on the expected format.`);if(null!=t.method&&!/^p(u|os)t$/i.test(t.method))throw new TypeError(`AwsS3: got incorrect method from 'getUploadParameters()' for file '${e.name}', expected  'put' or 'post' but got '${t.method}' instead.\nSee https://uppy.io/docs/aws-s3/#getUploadParameters-file for more on the expected format.`)}(r,i);const{method:n="post",url:a,fields:l,headers:p}=i,u={method:n,formData:"post"===n.toLowerCase(),endpoint:a,allowedMetaFields:l?Object.keys(l):[]};return p&&(u.headers=p),this.uppy.setFileState(r.id,{meta:{...r.meta,...l},xhrUpload:u}),cs(this,Ss)[Ss].uploadFile(r.id,s,o)})).catch((s=>{delete t[e];const i=this.uppy.getFile(e);return this.uppy.emit("upload-error",i,s),Promise.reject(s)})))))).finally((()=>{this.uppy.off("file-removed",s)}))}}),Object.defineProperty(this,Us,{writable:!0,value:()=>(cs(this,ws)[ws].setCompanionHeaders(this.opts.companionHeaders),Promise.resolve())}),this.type="uploader",this.id=this.opts.id||"AwsS3",this.title="AWS S3",this.defaultLocale=hs;const s={timeout:3e4,limit:0,allowedMetaFields:[],getUploadParameters:this.getUploadParameters.bind(this),shouldUseMultipart:!1,companionHeaders:{}};if(this.opts={...s,...t},void 0===(null==t?void 0:t.allowedMetaFields)&&"metaFields"in this.opts)throw new Error("The `metaFields` option has been renamed to `allowedMetaFields`.");this.i18nInit(),cs(this,ws)[ws]=new b(e,t),cs(this,Ps)[Ps]=new ue(this.opts.limit)}[ds](){return cs(this,ws)[ws]}get client(){return cs(this,ws)[ws]}set client(e){cs(this,ws)[ws]=e}getUploadParameters(e){if(!this.opts.companionUrl)throw new Error("Expected a `companionUrl` option containing a Companion address.");const t=e.meta.name,{type:s}=e.meta,i=Object.fromEntries(this.opts.allowedMetaFields.filter((t=>null!=e.meta[t])).map((t=>[`metadata[${t}]`,e.meta[t].toString()]))),r=new URLSearchParams({filename:t,type:s,...i});return cs(this,ws)[ws].get(`s3/params?${r}`).then(ys)}install(){const{uppy:e}=this;e.addPreProcessor(cs(this,Us)[Us]),e.addUploader(cs(this,Os)[Os]);const t={fieldName:"file",responseUrlFieldName:"location",timeout:this.opts.timeout,[ge]:cs(this,Ps)[Ps],responseType:"text",getResponseData:this.opts.getResponseData||function(t,s){const i=this;return us(t,s)?{location:(r=s.responseURL,o=gs(t,"Location"),r||o.startsWith("https://")||o.startsWith("http://")||(o=`https://${o}`),new URL(o,r||void 0).toString()),bucket:gs(t,"Bucket"),key:gs(t,"Key"),etag:gs(t,"ETag")}:"POST"===i.method.toUpperCase()?(bs||(e.log("[AwsS3] No response data found, make sure to set the success_action_status AWS SDK option to 201. See https://uppy.io/docs/aws-s3/#POST-Uploads","warning"),bs=!0),{location:null}):s.responseURL?{location:s.responseURL.replace(/\?.*$/,"")}:{location:null};var r,o},getResponseError:vs};t.i18n=this.i18n,cs(this,Ss)[Ss]=new rs(e,t)}uninstall(){this.uppy.removePreProcessor(cs(this,Us)[Us]),this.uppy.removeUploader(cs(this,Os)[Os])}}Es.VERSION="3.2.0"},28596:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(14136);class r{constructor(e,t){void 0===t&&(t={}),this.uppy=e,this.opts=t}getPluginState(){const{plugins:e}=this.uppy.getState();return e[this.id]||{}}setPluginState(e){const{plugins:t}=this.uppy.getState();this.uppy.setState({plugins:{...t,[this.id]:{...t[this.id],...e}}})}setOptions(e){this.opts={...this.opts,...e},this.setPluginState(),this.i18nInit()}i18nInit(){const e=new i.Z([this.defaultLocale,this.uppy.locale,this.opts.locale]);this.i18n=e.translate.bind(e),this.i18nArray=e.translateArray.bind(e),this.setPluginState()}addTarget(){throw new Error("Extend the addTarget method to add your plugin to another plugin's target")}install(){}uninstall(){}render(){throw new Error("Extend the render method to add your plugin to a DOM element")}update(){}afterUpdate(){}}},48465:(e,t,s)=>{s.d(t,{ZP:()=>me});var i=s(14136),r=s(44800);var o=s(23493);function n(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var a=0;function l(e){return"__private_"+a+++"_"+e}var p=l("callbacks"),u=l("publish");class h{constructor(){Object.defineProperty(this,u,{value:d}),Object.defineProperty(this,p,{writable:!0,value:new Set}),this.state={}}getState(){return this.state}setState(e){const t={...this.state},s={...this.state,...e};this.state=s,n(this,u)[u](t,s,e)}subscribe(e){return n(this,p)[p].add(e),()=>{n(this,p)[p].delete(e)}}}function d(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];n(this,p)[p].forEach((e=>{e(...t)}))}h.VERSION="3.0.3";const c=h;function m(e){const t=e.lastIndexOf(".");return-1===t||t===e.length-1?{name:e,extension:void 0}:{name:e.slice(0,t),extension:e.slice(t+1)}}const f={md:"text/markdown",markdown:"text/markdown",mp4:"video/mp4",mp3:"audio/mp3",svg:"image/svg+xml",jpg:"image/jpeg",png:"image/png",webp:"image/webp",gif:"image/gif",heic:"image/heic",heif:"image/heif",yaml:"text/yaml",yml:"text/yaml",csv:"text/csv",tsv:"text/tab-separated-values",tab:"text/tab-separated-values",avi:"video/x-msvideo",mks:"video/x-matroska",mkv:"video/x-matroska",mov:"video/quicktime",dicom:"application/dicom",doc:"application/msword",docm:"application/vnd.ms-word.document.macroenabled.12",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dot:"application/msword",dotm:"application/vnd.ms-word.template.macroenabled.12",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",xla:"application/vnd.ms-excel",xlam:"application/vnd.ms-excel.addin.macroenabled.12",xlc:"application/vnd.ms-excel",xlf:"application/x-xliff+xml",xlm:"application/vnd.ms-excel",xls:"application/vnd.ms-excel",xlsb:"application/vnd.ms-excel.sheet.binary.macroenabled.12",xlsm:"application/vnd.ms-excel.sheet.macroenabled.12",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xlt:"application/vnd.ms-excel",xltm:"application/vnd.ms-excel.template.macroenabled.12",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xlw:"application/vnd.ms-excel",txt:"text/plain",text:"text/plain",conf:"text/plain",log:"text/plain",pdf:"application/pdf",zip:"application/zip","7z":"application/x-7z-compressed",rar:"application/x-rar-compressed",tar:"application/x-tar",gz:"application/gzip",dmg:"application/x-apple-diskimage"};function g(e){var t;if(e.type)return e.type;const s=e.name?null==(t=m(e.name).extension)?void 0:t.toLowerCase():null;return s&&s in f?f[s]:"application/octet-stream"}function y(e){let t="";return e.replace(/[^A-Z0-9]/gi,(e=>(t+=`-${function(e){return e.charCodeAt(0).toString(32)}(e)}`,"/")))+t}function v(e){if(function(e){return!(!e.isRemote||!e.remote)&&new Set(["box","dropbox","drive","facebook","unsplash"]).has(e.remote.provider)}(e))return e.id;const t=g(e);return function(e){let t="uppy";return"string"===typeof e.name&&(t+=`-${y(e.name.toLowerCase())}`),void 0!==e.type&&(t+=`-${e.type}`),e.meta&&"string"===typeof e.meta.relativePath&&(t+=`-${y(e.meta.relativePath.toLowerCase())}`),void 0!==e.data.size&&(t+=`-${e.data.size}`),void 0!==e.data.lastModified&&(t+=`-${e.data.lastModified}`),t}({...e,type:t})}function b(e){if(null==e&&"undefined"!==typeof navigator&&(e=navigator.userAgent),!e)return!0;const t=/Edge\/(\d+\.\d+)/.exec(e);if(!t)return!0;const s=t[1];let[i,r]=s.split(".");return i=parseInt(i,10),r=parseInt(r,10),i<15||15===i&&r<15063||(i>18||18===i&&r>=18218)}function w(e){return e<10?`0${e}`:e.toString()}function P(){const e=new Date;return`${w(e.getHours())}:${w(e.getMinutes())}:${w(e.getSeconds())}`}const S={debug:()=>{},warn:()=>{},error:function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return console.error(`[Uppy] [${P()}]`,...t)}},O={debug:function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return console.debug(`[Uppy] [${P()}]`,...t)},warn:function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return console.warn(`[Uppy] [${P()}]`,...t)},error:function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return console.error(`[Uppy] [${P()}]`,...t)}};var U=s(85158),E=s(24193);const k={maxFileSize:null,minFileSize:null,maxTotalFileSize:null,maxNumberOfFiles:null,minNumberOfFiles:null,allowedFileTypes:null,requiredMetaFields:[]};class j extends Error{constructor(e,t){let{isUserFacing:s=!0,file:i}=void 0===t?{}:t;super(e),this.isRestriction=!0,this.isUserFacing=s,null!=i&&(this.file=i)}}class F{constructor(e,t){this.i18n=t,this.getOpts=()=>{const t=e();if(null!=t.restrictions.allowedFileTypes&&!Array.isArray(t.restrictions.allowedFileTypes))throw new TypeError("`restrictions.allowedFileTypes` must be an array");return t}}validateAggregateRestrictions(e,t){const{maxTotalFileSize:s,maxNumberOfFiles:i}=this.getOpts().restrictions;if(i){if(e.filter((e=>!e.isGhost)).length+t.length>i)throw new j(`${this.i18n("youCanOnlyUploadX",{smart_count:i})}`)}if(s){let i=e.reduce(((e,t)=>e+t.size),0);for(const e of t)if(null!=e.size&&(i+=e.size,i>s))throw new j(this.i18n("exceedsSize",{size:U(s),file:e.name}))}}validateSingleFile(e){const{maxFileSize:t,minFileSize:s,allowedFileTypes:i}=this.getOpts().restrictions;if(i){if(!i.some((t=>t.includes("/")?!!e.type&&E(e.type.replace(/;.*?$/,""),t):!("."!==t[0]||!e.extension)&&e.extension.toLowerCase()===t.slice(1).toLowerCase()))){const t=i.join(", ");throw new j(this.i18n("youCanOnlyUploadFileTypes",{types:t}),{file:e})}}if(t&&null!=e.size&&e.size>t)throw new j(this.i18n("exceedsSize",{size:U(t),file:e.name}),{file:e});if(s&&null!=e.size&&e.size<s)throw new j(this.i18n("inferiorSize",{size:U(s)}),{file:e})}validate(e,t){t.forEach((e=>{this.validateSingleFile(e)})),this.validateAggregateRestrictions(e,t)}validateMinNumberOfFiles(e){const{minNumberOfFiles:t}=this.getOpts().restrictions;if(Object.keys(e).length<t)throw new j(this.i18n("youHaveToAtLeastSelectX",{smart_count:t}))}getMissingRequiredMetaFields(e){const t=new j(this.i18n("missingRequiredMetaFieldOnFile",{fileName:e.name})),{requiredMetaFields:s}=this.getOpts().restrictions,i=[];for(const r of s)Object.hasOwn(e.meta,r)&&""!==e.meta[r]||i.push(r);return{missingFields:i,error:t}}}const T={strings:{addBulkFilesFailed:{0:"Failed to add %{smart_count} file due to an internal error",1:"Failed to add %{smart_count} files due to internal errors"},youCanOnlyUploadX:{0:"You can only upload %{smart_count} file",1:"You can only upload %{smart_count} files"},youHaveToAtLeastSelectX:{0:"You have to select at least %{smart_count} file",1:"You have to select at least %{smart_count} files"},exceedsSize:"%{file} exceeds maximum allowed size of %{size}",missingRequiredMetaField:"Missing required meta fields",missingRequiredMetaFieldOnFile:"Missing required meta fields in %{fileName}",inferiorSize:"This file is smaller than the allowed size of %{size}",youCanOnlyUploadFileTypes:"You can only upload: %{types}",noMoreFilesAllowed:"Cannot add more files",noDuplicates:"Cannot add the duplicate file '%{fileName}', it already exists",companionError:"Connection with Companion failed",authAborted:"Authentication aborted",companionUnauthorizeHint:"To unauthorize to your %{provider} account, please go to %{url}",failedToUpload:"Failed to upload %{file}",noInternetConnection:"No Internet connection",connectedToInternet:"Connected to the Internet",noFilesFound:"You have no files or folders here",noSearchResults:"Unfortunately, there are no results for this search",selectX:{0:"Select %{smart_count}",1:"Select %{smart_count}"},allFilesFromFolderNamed:"All files from folder %{name}",openFolderNamed:"Open folder %{name}",cancel:"Cancel",logOut:"Log out",filter:"Filter",resetFilter:"Reset filter",loading:"Loading...",authenticateWithTitle:"Please authenticate with %{pluginName} to select files",authenticateWith:"Connect to %{pluginName}",signInWithGoogle:"Sign in with Google",searchImages:"Search for images",enterTextToSearch:"Enter text to search for images",search:"Search",resetSearch:"Reset search",emptyFolderAdded:"No files were added from empty folder",addedNumFiles:"Added %{numFiles} file(s)",folderAlreadyAdded:'The folder "%{folder}" was already added',folderAdded:{0:"Added %{smart_count} file from %{folder}",1:"Added %{smart_count} files from %{folder}"},additionalRestrictionsFailed:"%{count} additional restrictions were not fulfilled"}};let R,A;function $(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var C=0;function x(e){return"__private_"+C+++"_"+e}var I=x("plugins"),M=x("restricter"),N=x("storeUnsubscribe"),q=x("emitter"),_=x("preProcessors"),z=x("uploaders"),L=x("postProcessors"),H=x("informAndEmit"),D=x("checkRequiredMetaFieldsOnFile"),B=x("checkRequiredMetaFields"),K=x("assertNewUploadAllowed"),V=x("transformFile"),W=x("startIfAutoProceed"),G=x("checkAndUpdateFileState"),X=x("addListeners"),Z=x("updateOnlineStatus"),J=x("createUpload"),Y=x("getUpload"),Q=x("removeUpload"),ee=x("runUpload");R=Symbol.for("uppy test: getPlugins"),A=Symbol.for("uppy test: createUpload");class te{constructor(e){Object.defineProperty(this,ee,{value:ce}),Object.defineProperty(this,Q,{value:de}),Object.defineProperty(this,Y,{value:he}),Object.defineProperty(this,J,{value:ue}),Object.defineProperty(this,X,{value:pe}),Object.defineProperty(this,G,{value:le}),Object.defineProperty(this,W,{value:ae}),Object.defineProperty(this,V,{value:ne}),Object.defineProperty(this,K,{value:oe}),Object.defineProperty(this,B,{value:re}),Object.defineProperty(this,D,{value:ie}),Object.defineProperty(this,H,{value:se}),Object.defineProperty(this,I,{writable:!0,value:Object.create(null)}),Object.defineProperty(this,M,{writable:!0,value:void 0}),Object.defineProperty(this,N,{writable:!0,value:void 0}),Object.defineProperty(this,q,{writable:!0,value:r()}),Object.defineProperty(this,_,{writable:!0,value:new Set}),Object.defineProperty(this,z,{writable:!0,value:new Set}),Object.defineProperty(this,L,{writable:!0,value:new Set}),this.calculateProgress=o(((e,t)=>{const s=this.getFile(null==e?void 0:e.id);if(null==e||!s)return void this.log(`Not setting progress for a file that has been removed: ${null==e?void 0:e.id}`);if(100===s.progress.percentage)return void this.log(`Not setting progress for a file that has been already uploaded: ${e.id}`);const i=Number.isFinite(t.bytesTotal)&&t.bytesTotal>0;this.setFileState(e.id,{progress:{...s.progress,bytesUploaded:t.bytesUploaded,bytesTotal:t.bytesTotal,percentage:i?Math.round(t.bytesUploaded/t.bytesTotal*100):0}}),this.calculateTotalProgress()}),500,{leading:!0,trailing:!0}),Object.defineProperty(this,Z,{writable:!0,value:this.updateOnlineStatus.bind(this)}),this.defaultLocale=T;const t={id:"uppy",autoProceed:!1,allowMultipleUploadBatches:!0,debug:!1,restrictions:k,meta:{},onBeforeFileAdded:e=>e,onBeforeUpload:e=>e,store:new c,logger:S,infoTimeout:5e3};this.opts={...t,...e,restrictions:{...t.restrictions,...e&&e.restrictions}},e&&e.logger&&e.debug?this.log("You are using a custom `logger`, but also set `debug: true`, which uses built-in logger to output logs to console. Ignoring `debug: true` and using your custom `logger`.","warning"):e&&e.debug&&(this.opts.logger=O),this.log(`Using Core v${this.constructor.VERSION}`),this.i18nInit(),this.store=this.opts.store,this.setState({plugins:{},files:{},currentUploads:{},allowNewUpload:!0,capabilities:{uploadProgress:b(),individualCancellation:!0,resumableUploads:!1},totalProgress:0,meta:{...this.opts.meta},info:[],recoveredState:null}),$(this,M)[M]=new F((()=>this.opts),this.i18n),$(this,N)[N]=this.store.subscribe(((e,t,s)=>{this.emit("state-update",e,t,s),this.updateAll(t)})),this.opts.debug&&"undefined"!==typeof window&&(window[this.opts.id]=this),$(this,X)[X]()}emit(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];$(this,q)[q].emit(e,...s)}on(e,t){return $(this,q)[q].on(e,t),this}once(e,t){return $(this,q)[q].once(e,t),this}off(e,t){return $(this,q)[q].off(e,t),this}updateAll(e){this.iteratePlugins((t=>{t.update(e)}))}setState(e){this.store.setState(e)}getState(){return this.store.getState()}patchFilesState(e){const t=this.getState().files;this.setState({files:{...t,...Object.fromEntries(Object.entries(e).map((e=>{let[s,i]=e;return[s,{...t[s],...i}]})))}})}setFileState(e,t){if(!this.getState().files[e])throw new Error(`Can\u2019t set state for ${e} (the file could have been removed)`);this.patchFilesState({[e]:t})}i18nInit(){const e=new i.Z([this.defaultLocale,this.opts.locale]);this.i18n=e.translate.bind(e),this.i18nArray=e.translateArray.bind(e),this.locale=e.locale}setOptions(e){this.opts={...this.opts,...e,restrictions:{...this.opts.restrictions,...e&&e.restrictions}},e.meta&&this.setMeta(e.meta),this.i18nInit(),e.locale&&this.iteratePlugins((t=>{t.setOptions(e)})),this.setState()}resetProgress(){const e={percentage:0,bytesUploaded:0,uploadComplete:!1,uploadStarted:null},t={...this.getState().files},s={};Object.keys(t).forEach((i=>{s[i]={...t[i],progress:{...t[i].progress,...e}}})),this.setState({files:s,totalProgress:0,allowNewUpload:!0,error:null,recoveredState:null}),this.emit("reset-progress")}addPreProcessor(e){$(this,_)[_].add(e)}removePreProcessor(e){return $(this,_)[_].delete(e)}addPostProcessor(e){$(this,L)[L].add(e)}removePostProcessor(e){return $(this,L)[L].delete(e)}addUploader(e){$(this,z)[z].add(e)}removeUploader(e){return $(this,z)[z].delete(e)}setMeta(e){const t={...this.getState().meta,...e},s={...this.getState().files};Object.keys(s).forEach((t=>{s[t]={...s[t],meta:{...s[t].meta,...e}}})),this.log("Adding metadata:"),this.log(e),this.setState({meta:t,files:s})}setFileMeta(e,t){const s={...this.getState().files};if(!s[e])return void this.log("Was trying to set metadata for a file that has been removed: ",e);const i={...s[e].meta,...t};s[e]={...s[e],meta:i},this.setState({files:s})}getFile(e){return this.getState().files[e]}getFiles(){const{files:e}=this.getState();return Object.values(e)}getFilesByIds(e){return e.map((e=>this.getFile(e)))}getObjectOfFilesPerState(){const{files:e,totalProgress:t,error:s}=this.getState(),i=Object.values(e),r=i.filter((e=>{let{progress:t}=e;return!t.uploadComplete&&t.uploadStarted})),o=i.filter((e=>!e.progress.uploadStarted)),n=i.filter((e=>e.progress.uploadStarted||e.progress.preprocess||e.progress.postprocess)),a=i.filter((e=>e.progress.uploadStarted)),l=i.filter((e=>e.isPaused)),p=i.filter((e=>e.progress.uploadComplete)),u=i.filter((e=>e.error)),h=r.filter((e=>!e.isPaused)),d=i.filter((e=>e.progress.preprocess||e.progress.postprocess));return{newFiles:o,startedFiles:n,uploadStartedFiles:a,pausedFiles:l,completeFiles:p,erroredFiles:u,inProgressFiles:r,inProgressNotPausedFiles:h,processingFiles:d,isUploadStarted:a.length>0,isAllComplete:100===t&&p.length===i.length&&0===d.length,isAllErrored:!!s&&u.length===i.length,isAllPaused:0!==r.length&&l.length===r.length,isUploadInProgress:r.length>0,isSomeGhost:i.some((e=>e.isGhost))}}validateRestrictions(e,t){void 0===t&&(t=this.getFiles());try{$(this,M)[M].validate(t,[e])}catch(s){return s}return null}checkIfFileAlreadyExists(e){const{files:t}=this.getState();return!(!t[e]||t[e].isGhost)}addFile(e){$(this,K)[K](e);const{nextFilesState:t,validFilesToAdd:s,errors:i}=$(this,G)[G]([e]),r=i.filter((e=>e.isRestriction));if($(this,H)[H](r),i.length>0)throw i[0];this.setState({files:t});const[o]=s;return this.emit("file-added",o),this.emit("files-added",s),this.log(`Added file: ${o.name}, ${o.id}, mime type: ${o.type}`),$(this,W)[W](),o.id}addFiles(e){$(this,K)[K]();const{nextFilesState:t,validFilesToAdd:s,errors:i}=$(this,G)[G](e),r=i.filter((e=>e.isRestriction));$(this,H)[H](r);const o=i.filter((e=>!e.isRestriction));if(o.length>0){let e="Multiple errors occurred while adding files:\n";if(o.forEach((t=>{e+=`\n * ${t.message}`})),this.info({message:this.i18n("addBulkFilesFailed",{smart_count:o.length}),details:e},"error",this.opts.infoTimeout),"function"===typeof AggregateError)throw new AggregateError(o,e);{const t=new Error(e);throw t.errors=o,t}}this.setState({files:t}),s.forEach((e=>{this.emit("file-added",e)})),this.emit("files-added",s),s.length>5?this.log(`Added batch of ${s.length} files`):Object.values(s).forEach((e=>{this.log(`Added file: ${e.name}\n id: ${e.id}\n type: ${e.type}`)})),s.length>0&&$(this,W)[W]()}removeFiles(e,t){const{files:s,currentUploads:i}=this.getState(),r={...s},o={...i},n=Object.create(null);function a(e){return void 0===n[e]}e.forEach((e=>{s[e]&&(n[e]=s[e],delete r[e])})),Object.keys(o).forEach((e=>{const t=i[e].fileIDs.filter(a);if(0===t.length)return void delete o[e];const{capabilities:s}=this.getState();if(t.length!==i[e].fileIDs.length&&!s.individualCancellation)throw new Error("individualCancellation is disabled");o[e]={...i[e],fileIDs:t}}));const l={currentUploads:o,files:r};0===Object.keys(r).length&&(l.allowNewUpload=!0,l.error=null,l.recoveredState=null),this.setState(l),this.calculateTotalProgress();const p=Object.keys(n);p.forEach((e=>{this.emit("file-removed",n[e],t)})),p.length>5?this.log(`Removed ${p.length} files`):this.log(`Removed files: ${p.join(", ")}`)}removeFile(e,t){void 0===t&&(t=null),this.removeFiles([e],t)}pauseResume(e){if(!this.getState().capabilities.resumableUploads||this.getFile(e).uploadComplete)return;const t=!(this.getFile(e).isPaused||!1);return this.setFileState(e,{isPaused:t}),this.emit("upload-pause",e,t),t}pauseAll(){const e={...this.getState().files};Object.keys(e).filter((t=>!e[t].progress.uploadComplete&&e[t].progress.uploadStarted)).forEach((t=>{const s={...e[t],isPaused:!0};e[t]=s})),this.setState({files:e}),this.emit("pause-all")}resumeAll(){const e={...this.getState().files};Object.keys(e).filter((t=>!e[t].progress.uploadComplete&&e[t].progress.uploadStarted)).forEach((t=>{const s={...e[t],isPaused:!1,error:null};e[t]=s})),this.setState({files:e}),this.emit("resume-all")}retryAll(){const e={...this.getState().files},t=Object.keys(e).filter((t=>e[t].error));if(t.forEach((t=>{const s={...e[t],isPaused:!1,error:null};e[t]=s})),this.setState({files:e,error:null}),this.emit("retry-all",t),0===t.length)return Promise.resolve({successful:[],failed:[]});const s=$(this,J)[J](t,{forceAllowNewUpload:!0});return $(this,ee)[ee](s)}cancelAll(e){let{reason:t="user"}=void 0===e?{}:e;if(this.emit("cancel-all",{reason:t}),"user"===t){const{files:e}=this.getState(),t=Object.keys(e);t.length&&this.removeFiles(t,"cancel-all"),this.setState({totalProgress:0,error:null,recoveredState:null})}}retryUpload(e){this.setFileState(e,{error:null,isPaused:!1}),this.emit("upload-retry",e);const t=$(this,J)[J]([e],{forceAllowNewUpload:!0});return $(this,ee)[ee](t)}logout(){this.iteratePlugins((e=>{e.provider&&e.provider.logout&&e.provider.logout()}))}calculateTotalProgress(){const e=this.getFiles().filter((e=>e.progress.uploadStarted||e.progress.preprocess||e.progress.postprocess));if(0===e.length)return this.emit("progress",0),void this.setState({totalProgress:0});const t=e.filter((e=>null!=e.progress.bytesTotal)),s=e.filter((e=>null==e.progress.bytesTotal));if(0===t.length){const t=100*e.length,i=s.reduce(((e,t)=>e+t.progress.percentage),0),r=Math.round(i/t*100);return void this.setState({totalProgress:r})}let i=t.reduce(((e,t)=>e+t.progress.bytesTotal),0);const r=i/t.length;i+=r*s.length;let o=0;t.forEach((e=>{o+=e.progress.bytesUploaded})),s.forEach((e=>{o+=r*(e.progress.percentage||0)/100}));let n=0===i?0:Math.round(o/i*100);n>100&&(n=100),this.setState({totalProgress:n}),this.emit("progress",n)}updateOnlineStatus(){"undefined"===typeof window.navigator.onLine||window.navigator.onLine?(this.emit("is-online"),this.wasOffline&&(this.emit("back-online"),this.info(this.i18n("connectedToInternet"),"success",3e3),this.wasOffline=!1)):(this.emit("is-offline"),this.info(this.i18n("noInternetConnection"),"error",0),this.wasOffline=!0)}getID(){return this.opts.id}use(e,t){if("function"!==typeof e){throw new TypeError(`Expected a plugin class, but got ${null===e?"null":typeof e}. Please verify that the plugin was imported and spelled correctly.`)}const s=new e(this,t),i=s.id;if(!i)throw new Error("Your plugin must have an id");if(!s.type)throw new Error("Your plugin must have a type");const r=this.getPlugin(i);if(r){const e=`Already found a plugin named '${r.id}'. Tried to use: '${i}'.\nUppy plugins must have unique \`id\` options. See https://uppy.io/docs/plugins/#id.`;throw new Error(e)}return e.VERSION&&this.log(`Using ${i} v${e.VERSION}`),s.type in $(this,I)[I]?$(this,I)[I][s.type].push(s):$(this,I)[I][s.type]=[s],s.install(),this}getPlugin(e){for(const t of Object.values($(this,I)[I])){const s=t.find((t=>t.id===e));if(null!=s)return s}}[R](e){return $(this,I)[I][e]}iteratePlugins(e){Object.values($(this,I)[I]).flat(1).forEach(e)}removePlugin(e){this.log(`Removing plugin ${e.id}`),this.emit("plugin-remove",e),e.uninstall&&e.uninstall();const t=$(this,I)[I][e.type],s=t.findIndex((t=>t.id===e.id));-1!==s&&t.splice(s,1);const i={plugins:{...this.getState().plugins,[e.id]:void 0}};this.setState(i)}close(e){let{reason:t}=void 0===e?{}:e;this.log(`Closing Uppy instance ${this.opts.id}: removing all files and uninstalling plugins`),this.cancelAll({reason:t}),$(this,N)[N](),this.iteratePlugins((e=>{this.removePlugin(e)})),"undefined"!==typeof window&&window.removeEventListener&&(window.removeEventListener("online",$(this,Z)[Z]),window.removeEventListener("offline",$(this,Z)[Z]))}hideInfo(){const{info:e}=this.getState();this.setState({info:e.slice(1)}),this.emit("info-hidden")}info(e,t,s){void 0===t&&(t="info"),void 0===s&&(s=3e3);const i="object"===typeof e;this.setState({info:[...this.getState().info,{type:t,message:i?e.message:e,details:i?e.details:null}]}),setTimeout((()=>this.hideInfo()),s),this.emit("info-visible")}log(e,t){const{logger:s}=this.opts;switch(t){case"error":s.error(e);break;case"warning":s.warn(e);break;default:s.debug(e)}}restore(e){return this.log(`Core: attempting to restore upload "${e}"`),this.getState().currentUploads[e]?$(this,ee)[ee](e):($(this,Q)[Q](e),Promise.reject(new Error("Nonexistent upload")))}[A](){return $(this,J)[J](...arguments)}addResultData(e,t){if(!$(this,Y)[Y](e))return void this.log(`Not setting result for an upload that has been removed: ${e}`);const{currentUploads:s}=this.getState(),i={...s[e],result:{...s[e].result,...t}};this.setState({currentUploads:{...s,[e]:i}})}upload(){var e;null!=(e=$(this,I)[I].uploader)&&e.length||this.log("No uploader type plugins are used","warning");let{files:t}=this.getState();const s=this.opts.onBeforeUpload(t);return!1===s?Promise.reject(new Error("Not starting the upload because onBeforeUpload returned false")):(s&&"object"===typeof s&&(t=s,this.setState({files:t})),Promise.resolve().then((()=>$(this,M)[M].validateMinNumberOfFiles(t))).catch((e=>{throw $(this,H)[H]([e]),e})).then((()=>{if(!$(this,B)[B](t))throw new j(this.i18n("missingRequiredMetaField"))})).catch((e=>{throw e})).then((()=>{const{currentUploads:e}=this.getState(),s=Object.values(e).flatMap((e=>e.fileIDs)),i=[];Object.keys(t).forEach((e=>{const t=this.getFile(e);t.progress.uploadStarted||-1!==s.indexOf(e)||i.push(t.id)}));const r=$(this,J)[J](i);return $(this,ee)[ee](r)})).catch((e=>{throw this.emit("error",e),this.log(e,"error"),e})))}}function se(e){for(const r of e){const{file:e,isRestriction:t}=r;t?this.emit("restriction-failed",e,r):this.emit("error",r),this.log(r,"warning")}const t=e.filter((e=>e.isUserFacing)),s=t.slice(0,4),i=t.slice(4);s.forEach((e=>{let{message:t,details:s=""}=e;this.info({message:t,details:s},"error",this.opts.infoTimeout)})),i.length>0&&this.info({message:this.i18n("additionalRestrictionsFailed",{count:i.length})})}function ie(e){const{missingFields:t,error:s}=$(this,M)[M].getMissingRequiredMetaFields(e);return!(t.length>0)||(this.setFileState(e.id,{missingRequiredMetaFields:t}),this.log(s.message),this.emit("restriction-failed",e,s),!1)}function re(e){let t=!0;for(const s of Object.values(e))$(this,D)[D](s)||(t=!1);return t}function oe(e){const{allowNewUpload:t}=this.getState();if(!1===t){const t=new j(this.i18n("noMoreFilesAllowed"),{file:e});throw $(this,H)[H]([t]),t}}function ne(e){const t=e instanceof File?{name:e.name,type:e.type,size:e.size,data:e}:e,s=g(t),i=function(e,t){return t.name?t.name:"image"===e.split("/")[0]?`${e.split("/")[0]}.${e.split("/")[1]}`:"noname"}(s,t),r=m(i).extension,o=Boolean(t.isRemote),n=v(t),a=t.meta||{};a.name=i,a.type=s;const l=Number.isFinite(t.data.size)?t.data.size:null;return{source:t.source||"",id:n,name:i,extension:r||"",meta:{...this.getState().meta,...a},type:s,data:t.data,progress:{percentage:0,bytesUploaded:0,bytesTotal:l,uploadComplete:!1,uploadStarted:null},size:l,isRemote:o,remote:t.remote||"",preview:t.preview}}function ae(){this.opts.autoProceed&&!this.scheduledAutoProceed&&(this.scheduledAutoProceed=setTimeout((()=>{this.scheduledAutoProceed=null,this.upload().catch((e=>{e.isRestriction||this.log(e.stack||e.message||e)}))}),4))}function le(e){const{files:t}=this.getState(),s={...t},i=[],r=[];for(const a of e)try{var o;let e=$(this,V)[V](a);if(null!=(o=t[e.id])&&o.isGhost){const{isGhost:s,...i}=t[e.id];e={...i,data:a.data},this.log(`Replaced the blob in the restored ghost file: ${e.name}, ${e.id}`)}if(this.checkIfFileAlreadyExists(e.id))throw new j(this.i18n("noDuplicates",{fileName:e.name}),{file:a});const r=this.opts.onBeforeFileAdded(e,s);if(!1===r)throw new j("Cannot add the file because onBeforeFileAdded returned false.",{isUserFacing:!1,file:a});"object"===typeof r&&null!==r&&(e=r),$(this,M)[M].validateSingleFile(e),s[e.id]=e,i.push(e)}catch(n){r.push(n)}try{$(this,M)[M].validateAggregateRestrictions(Object.values(t),i)}catch(n){return r.push(n),{nextFilesState:t,validFilesToAdd:[],errors:r}}return{nextFilesState:s,validFilesToAdd:i,errors:r}}function pe(){const e=(e,t,s)=>{let i=e.message||"Unknown error";e.details&&(i+=` ${e.details}`),this.setState({error:i}),null!=t&&t.id in this.getState().files&&this.setFileState(t.id,{error:i,response:s})};let t;this.on("error",e),this.on("upload-error",((t,s,i)=>{if(e(s,t,i),"object"===typeof s&&s.message){const e=new Error(s.message);e.isUserFacing=!0,e.details=s.message,s.details&&(e.details+=` ${s.details}`),e.message=this.i18n("failedToUpload",{file:null==t?void 0:t.name}),$(this,H)[H]([e])}else $(this,H)[H]([s])})),this.on("upload-stalled",((e,s)=>{const{message:i}=e,r=s.map((e=>e.meta.name)).join(", ");t||(this.info({message:i,details:r},"warning",this.opts.infoTimeout),t=setTimeout((()=>{t=null}),this.opts.infoTimeout)),this.log(`${i} ${r}`.trim(),"warning")})),this.on("upload",(()=>{this.setState({error:null})}));const s=e=>{const t=e.filter((e=>{const t=null!=e&&this.getFile(e.id);return t||this.log(`Not setting progress for a file that has been removed: ${null==e?void 0:e.id}`),t})),s=Object.fromEntries(t.map((e=>[e.id,{progress:{uploadStarted:Date.now(),uploadComplete:!1,percentage:0,bytesUploaded:0,bytesTotal:e.size}}])));this.patchFilesState(s)};this.on("upload-start",(e=>{e.forEach((e=>{this.emit("upload-started",e)})),s(e)})),this.on("upload-progress",this.calculateProgress),this.on("upload-success",((e,t)=>{if(null==e||!this.getFile(e.id))return void this.log(`Not setting progress for a file that has been removed: ${null==e?void 0:e.id}`);const s=this.getFile(e.id).progress;this.setFileState(e.id,{progress:{...s,postprocess:$(this,L)[L].size>0?{mode:"indeterminate"}:null,uploadComplete:!0,percentage:100,bytesUploaded:s.bytesTotal},response:t,uploadURL:t.uploadURL,isPaused:!1}),null==e.size&&this.setFileState(e.id,{size:t.bytesUploaded||s.bytesTotal}),this.calculateTotalProgress()})),this.on("preprocess-progress",((e,t)=>{null!=e&&this.getFile(e.id)?this.setFileState(e.id,{progress:{...this.getFile(e.id).progress,preprocess:t}}):this.log(`Not setting progress for a file that has been removed: ${null==e?void 0:e.id}`)})),this.on("preprocess-complete",(e=>{if(null==e||!this.getFile(e.id))return void this.log(`Not setting progress for a file that has been removed: ${null==e?void 0:e.id}`);const t={...this.getState().files};t[e.id]={...t[e.id],progress:{...t[e.id].progress}},delete t[e.id].progress.preprocess,this.setState({files:t})})),this.on("postprocess-progress",((e,t)=>{null!=e&&this.getFile(e.id)?this.setFileState(e.id,{progress:{...this.getState().files[e.id].progress,postprocess:t}}):this.log(`Not setting progress for a file that has been removed: ${null==e?void 0:e.id}`)})),this.on("postprocess-complete",(e=>{if(null==e||!this.getFile(e.id))return void this.log(`Not setting progress for a file that has been removed: ${null==e?void 0:e.id}`);const t={...this.getState().files};t[e.id]={...t[e.id],progress:{...t[e.id].progress}},delete t[e.id].progress.postprocess,this.setState({files:t})})),this.on("restored",(()=>{this.calculateTotalProgress()})),this.on("dashboard:file-edit-complete",(e=>{e&&$(this,D)[D](e)})),"undefined"!==typeof window&&window.addEventListener&&(window.addEventListener("online",$(this,Z)[Z]),window.addEventListener("offline",$(this,Z)[Z]),setTimeout($(this,Z)[Z],3e3))}function ue(e,t){void 0===t&&(t={});const{forceAllowNewUpload:s=!1}=t,{allowNewUpload:i,currentUploads:r}=this.getState();if(!i&&!s)throw new Error("Cannot create a new upload: already uploading.");const o=((e=21)=>{let t="",s=e;for(;s--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[64*Math.random()|0];return t})();return this.emit("upload",{id:o,fileIDs:e}),this.setState({allowNewUpload:!1!==this.opts.allowMultipleUploadBatches&&!1!==this.opts.allowMultipleUploads,currentUploads:{...r,[o]:{fileIDs:e,step:0,result:{}}}}),o}function he(e){const{currentUploads:t}=this.getState();return t[e]}function de(e){const t={...this.getState().currentUploads};delete t[e],this.setState({currentUploads:t})}async function ce(e){const t=()=>{const{currentUploads:t}=this.getState();return t[e]};let s=t();const i=[...$(this,_)[_],...$(this,z)[z],...$(this,L)[L]];try{for(let r=s.step||0;r<i.length&&s;r++){const o=i[r];this.setState({currentUploads:{...this.getState().currentUploads,[e]:{...s,step:r}}});const{fileIDs:n}=s;await o(n,e),s=t()}}catch(o){throw $(this,Q)[Q](e),o}if(s){s.fileIDs.forEach((e=>{const t=this.getFile(e);t&&t.progress.postprocess&&this.emit("postprocess-complete",t)}));const i=s.fileIDs.map((e=>this.getFile(e))),r=i.filter((e=>!e.error)),o=i.filter((e=>e.error));await this.addResultData(e,{successful:r,failed:o,uploadID:e}),s=t()}let r;return s&&(r=s.result,this.emit("complete",r),$(this,Q)[Q](e)),null==r&&this.log(`Not setting result for an upload that has been removed: ${e}`),r}te.VERSION="3.2.1";const me=te;s(6400)},14136:(e,t,s)=>{function i(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}s.d(t,{Z:()=>p});var r=0;function o(e){return"__private_"+r+++"_"+e}function n(e,t,s){const i=[];return e.forEach((e=>"string"!==typeof e?i.push(e):t[Symbol.split](e).forEach(((e,t,r)=>{""!==e&&i.push(e),t<r.length-1&&i.push(s)})))),i}function a(e,t){const s=/\$/g;let i=[e];if(null==t)return i;for(const r of Object.keys(t))if("_"!==r){let e=t[r];"string"===typeof e&&(e=s[Symbol.replace](e,"$$$$")),i=n(i,new RegExp(`%\\{${r}\\}`,"g"),e)}return i}var l=o("apply");class p{constructor(e){Object.defineProperty(this,l,{value:u}),this.locale={strings:{},pluralize:e=>1===e?0:1},Array.isArray(e)?e.forEach(i(this,l)[l],this):i(this,l)[l](e)}translate(e,t){return this.translateArray(e,t).join("")}translateArray(e,t){if(!function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(this.locale.strings,e))throw new Error(`missing string: ${e}`);const s=this.locale.strings[e];if("object"===typeof s){if(t&&"undefined"!==typeof t.smart_count){return a(s[this.locale.pluralize(t.smart_count)],t)}throw new Error("Attempted to use a string with plural forms, but no value was given for %{smart_count}")}return a(s,t)}}function u(e){if(null==e||!e.strings)return;const t=this.locale;this.locale={...t,strings:{...t.strings,...e.strings}},this.locale.pluralize=e.pluralize||t.pluralize}}}]);
//# sourceMappingURL=3316-05a4a5f6a5636118c73b.js.map